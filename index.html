<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="记录些学习笔记，随便写写。">
<meta property="og:type" content="website">
<meta property="og:title" content="Azetus的随笔">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Azetus的随笔">
<meta property="og:description" content="记录些学习笔记，随便写写。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Azem">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Azetus的随笔</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Azetus的随笔</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/21/JavaScript%EF%BC%9A%E4%B8%BA%E4%BD%950-1-0-2-0-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/azem.png">
      <meta itemprop="name" content="Azem">
      <meta itemprop="description" content="记录些学习笔记，随便写写。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Azetus的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/21/JavaScript%EF%BC%9A%E4%B8%BA%E4%BD%950-1-0-2-0-3/" class="post-title-link" itemprop="url">JavaScript：为何0.1+0.2 != 0.3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-21 14:49:00" itemprop="dateCreated datePublished" datetime="2022-05-21T14:49:00+08:00">2022-05-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">JavaScript进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="JavaScript-是怎样进行数字相加的"><a href="#JavaScript-是怎样进行数字相加的" class="headerlink" title="JavaScript 是怎样进行数字相加的"></a>JavaScript 是怎样进行数字相加的</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">0.1</span> + <span class="number">0.2</span>)</span><br><span class="line"><span class="comment">// 0.30000000000000004</span></span><br></pre></td></tr></table></figure>

<ul>
<li>  十进制和二进制是如何相互转换的</li>
<li>  浮点数是以什么格式存储的</li>
<li>  计算机如何进行加法</li>
</ul>
<h2 id="进制转换-十进制转换二进制"><a href="#进制转换-十进制转换二进制" class="headerlink" title="进制转换 - 十进制转换二进制"></a>进制转换 - 十进制转换二进制</h2><ul>
<li>  整数：除 2 取余，逆序排列</li>
<li>  小数：乘 2 取整，顺序排列</li>
</ul>
<h2 id="例：9-375"><a href="#例：9-375" class="headerlink" title="例：9.375"></a>例：9.375</h2><p>整数部分 9 -&gt; 1001</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">9 % 2  1</span><br><span class="line">4 % 2  0</span><br><span class="line">2 % 2  0</span><br><span class="line">1 % 2  1</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p>小数部分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0.375 * 2 -&gt; 0.75 -&gt; 0</span><br><span class="line"> 0.75 * 2 -&gt; 1.5  -&gt; 1</span><br><span class="line">  0.5 * 2 -&gt; 1    -&gt; 1</span><br></pre></td></tr></table></figure>

<p>二进制表示：1001.011</p>
<h2 id="进制转换-二进制转十进制"><a href="#进制转换-二进制转十进制" class="headerlink" title="进制转换 - 二进制转十进制"></a>进制转换 - 二进制转十进制</h2><ul>
<li>  小数点前：<font color=red>从右到左</font>用二进制的每个数乘以 2 的相应<font color=red>次方递增</font></li>
<li>  小数点后：<font color=red>从左到右</font>用二进制的每个数乘以 2 的相应<font color=red>负次方递增</font></li>
</ul>
<p><img src="/2022/05/21/JavaScript%EF%BC%9A%E4%B8%BA%E4%BD%950-1-0-2-0-3/4-3-6.png" alt="4-3-6"></p>
<p>整数部分： 1001 = 1*2^0 + 0*2^1 + 0*2^2 + 1*2^3 = 1 + 0 + 0 + 8 = 9<br>小数部分： 011 = 0*2^-1 + 1*2^-2 + 1* 2^-3 = 0 + 0.25 + 0.125 = 0.375</p>
<h2 id="双精度-64-位浮点数"><a href="#双精度-64-位浮点数" class="headerlink" title="双精度 64 位浮点数"></a>双精度 64 位浮点数</h2><p><img src="/2022/05/21/JavaScript%EF%BC%9A%E4%B8%BA%E4%BD%950-1-0-2-0-3/4-3-7.png" alt="4-3-7"></p>
<table>
<thead>
<tr>
<th>组成</th>
<th>描述</th>
<th>位数</th>
<th>位置</th>
</tr>
</thead>
<tbody><tr>
<td>符号位 Sign</td>
<td>符号，0 为正，1 为负</td>
<td>1bit</td>
<td>b63</td>
</tr>
<tr>
<td>指数位 Exponent</td>
<td>指数部分，E=指数+1023(偏移码)</td>
<td>11bit</td>
<td>b62 - b52</td>
</tr>
<tr>
<td>尾数部分 Fraction</td>
<td>小数部分</td>
<td>52bit</td>
<td>b51- b0</td>
</tr>
</tbody></table>
<p>以 103.625 浮点数为例</p>
<p><img src="/2022/05/21/JavaScript%EF%BC%9A%E4%B8%BA%E4%BD%950-1-0-2-0-3/4-3-8.png" alt="4-3-8"><br><img src="/2022/05/21/JavaScript%EF%BC%9A%E4%B8%BA%E4%BD%950-1-0-2-0-3/4-3-9.png" alt="4-3-9"></p>
<h2 id="浮点数运算"><a href="#浮点数运算" class="headerlink" title="浮点数运算"></a>浮点数运算</h2><ul>
<li>  对阶</li>
<li>  尾数运算</li>
<li>  规格化</li>
<li>  舍入处理</li>
<li>  溢出判断</li>
</ul>
<h3 id="1-浮点数运算-对阶"><a href="#1-浮点数运算-对阶" class="headerlink" title="1. 浮点数运算 - 对阶"></a>1. 浮点数运算 - 对阶</h3><ul>
<li>  对阶-保持指数位数字一致</li>
<li>  小阶对大阶</li>
</ul>
<p>例：123.5 + 1426.00456 （以十进制为例去理解）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">     1.235 * 10 ^ 2</span><br><span class="line">    0.1235 * 10 ^ 3</span><br><span class="line">1.42600456 * 10 ^ 3</span><br></pre></td></tr></table></figure>

<h4 id="对阶-精度丢失问题"><a href="#对阶-精度丢失问题" class="headerlink" title="对阶-精度丢失问题"></a>对阶-精度丢失问题</h4><ul>
<li>  小阶对大大阶，小阶右移，容易丢失位数</li>
<li>  相加或者相减，值可能溢出</li>
</ul>
<h3 id="2-浮点数运算-对阶"><a href="#2-浮点数运算-对阶" class="headerlink" title="2. 浮点数运算 - 对阶"></a>2. 浮点数运算 - 对阶</h3><ul>
<li>  尾数运算就是在完成对阶后进行尾数相加减</li>
</ul>
<h3 id="3-浮点数运算-结果规格化"><a href="#3-浮点数运算-结果规格化" class="headerlink" title="3. 浮点数运算 = 结果规格化"></a>3. 浮点数运算 = 结果规格化</h3><ul>
<li>  1.M 的形式 例子：17.051 -&gt; 1.7051</li>
<li>  左移规格化</li>
<li>  右移规格化（精度可能丢失）</li>
</ul>
<h3 id="4-浮点数运算-舍入处理"><a href="#4-浮点数运算-舍入处理" class="headerlink" title="4. 浮点数运算 - 舍入处理"></a>4. 浮点数运算 - 舍入处理</h3><blockquote>
<p>尾数右移时会丢失位数，而移出的位数会被暂时保存下来，在舍入处理时使用</p>
</blockquote>
<ul>
<li>  舍入到最近（默认，1 入 0 舍）</li>
<li>  朝 +∞ 方向舍入</li>
<li>  朝 -∞ 方向舍入</li>
<li>  朝 0 方向舍入</li>
</ul>
<h3 id="5-浮点数运算-溢出判断"><a href="#5-浮点数运算-溢出判断" class="headerlink" title="5. 浮点数运算 - 溢出判断"></a>5. 浮点数运算 - 溢出判断</h3><ul>
<li>  运算结果的阶码的值判断是否溢出</li>
<li>超过最大正数（上溢）：<ul>
<li>  浮点数正数（正上溢）</li>
<li>  浮点数负数（负上溢）</li>
</ul>
</li>
</ul>
<hr>
<h1 id="0-1-0-2-0-3"><a href="#0-1-0-2-0-3" class="headerlink" title="0.1 + 0.2 != 0.3"></a>0.1 + 0.2 != 0.3</h1><p>IEEE 754 计算步骤</p>
<ol>
<li>对阶</li>
<li>尾数运算</li>
<li>结果规格化</li>
<li>舍入处理</li>
<li>溢出检查</li>
</ol>
<h2 id="换算成-IEEE-754-标准二进制结构"><a href="#换算成-IEEE-754-标准二进制结构" class="headerlink" title="换算成 IEEE 754 标准二进制结构"></a>换算成 IEEE 754 标准二进制结构</h2><ul>
<li>  0.1 转二进制（小数转二进制）：直到乘积中的小数部分为 0</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">2 * 0.1</span><br><span class="line">2 * 0.2     0</span><br><span class="line"></span><br><span class="line">2 * 0.4     0</span><br><span class="line">2 * 0.8     0</span><br><span class="line">2 * 1.6     1</span><br><span class="line">2 * 1.2     1</span><br><span class="line"></span><br><span class="line">2 * 0.4     0</span><br><span class="line">2 * 0.8     0</span><br><span class="line">2 * 1.6     1</span><br><span class="line">2 * 1.2     1</span><br><span class="line"></span><br><span class="line">无限循环 0011</span><br></pre></td></tr></table></figure>

<ul>
<li>  规格化：<code>0.0 0011 0011 (0011)n</code> =&gt; <code>1.1001 1001 (1001)n * 2^-4</code></li>
<li>  符号位：0</li>
<li>  指数位：1023 + 指数 = 1019 (01111111011)</li>
<li>  尾数位：由于无限循环，采用就近舍入（1 入 0 舍）保留 52 位，最后结尾 1001 =&gt; 1010</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0.1 =&gt;</span><br><span class="line">0 | 01111111011 | 10011001 10011001 10011001 10011001 10011001 10011001 1010</span><br><span class="line"></span><br><span class="line">0.2 =&gt;</span><br><span class="line">0 | 01111111100 | 10011001 10011001 10011001 10011001 10011001 10011001 1010</span><br></pre></td></tr></table></figure>

<h2 id="对阶"><a href="#对阶" class="headerlink" title="对阶"></a>对阶</h2><ul>
<li>小阶对大阶<ul>
<li>  0.1 的指数为 01111111011 = 1019</li>
<li>  0.2 的指数为 01111111100 = 1020</li>
</ul>
</li>
<li>  0.1 指数部分变为 1020，同时位数右移一位，尾数部分是 1.M 的形式</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0.1 =&gt;</span><br><span class="line">0 | 01111111011 | 10011001 10011001 10011001 10011001 10011001 10011001 1010</span><br><span class="line"></span><br><span class="line">0 | 01111111100 | 1 10011001 10011001 10011001 10011001 10011001 10011001 1010</span><br></pre></td></tr></table></figure>

<h2 id="位数运算"><a href="#位数运算" class="headerlink" title="位数运算"></a>位数运算</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0.1 + 0.2 =&gt;</span><br><span class="line"></span><br><span class="line"> 0. 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1101 0</span><br><span class="line"> 1. 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1010</span><br><span class="line">=&gt;</span><br><span class="line">10. 0110 0110 0110 0110 0110 0110 0110 0110 0110 0110 0110 0110 0111 0</span><br></pre></td></tr></table></figure>

<h2 id="结果规格化"><a href="#结果规格化" class="headerlink" title="结果规格化"></a>结果规格化</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10. 0110 0110 0110 0110 0110 0110 0110 0110 0110 0110 0110 0110 0111 0</span><br><span class="line"></span><br><span class="line"> 1.00110 0110 0110 0110 0110 0110 0110 0110 0110 0110 0110 0110 0111 0</span><br></pre></td></tr></table></figure>

<ul>
<li>  指数位+1，变为 1020+1=&gt;1021，二进制：01111111101</li>
</ul>
<h2 id="舍入处理"><a href="#舍入处理" class="headerlink" title="舍入处理"></a>舍入处理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 10 (54位)</span><br><span class="line"></span><br><span class="line">1.0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0100</span><br></pre></td></tr></table></figure>

<h2 id="溢出检查"><a href="#溢出检查" class="headerlink" title="溢出检查"></a>溢出检查</h2><ul>
<li>  指数 1021 没有溢出</li>
</ul>
<h2 id="最终结果"><a href="#最终结果" class="headerlink" title="最终结果"></a>最终结果</h2><ul>
<li>  符号位 S：0</li>
<li>  指数位 E：0.1-1019，0.2-1020，计算后指数位 1021（1021，二进制：01111111101）</li>
<li>  尾数位 M：0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0100</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 | 01111111101 | 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0100</span><br></pre></td></tr></table></figure>

<p>结果为：<br>V = (-1)^S * (1.M) * 2^(E-1023)</p>
<ol>
<li>(-1)^S = -1^0 = 1</li>
<li>1.M * 2^(1021-1023) = 0.30000000000000004</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/21/JavaScript%EF%BC%9A%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/azem.png">
      <meta itemprop="name" content="Azem">
      <meta itemprop="description" content="记录些学习笔记，随便写写。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Azetus的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/21/JavaScript%EF%BC%9A%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/" class="post-title-link" itemprop="url">JavaScript：位运算符</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-21 14:45:56" itemprop="dateCreated datePublished" datetime="2022-05-21T14:45:56+08:00">2022-05-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">JavaScript进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="位运算符的妙用：奇偶数，色值换算，换值，-编码等"><a href="#位运算符的妙用：奇偶数，色值换算，换值，-编码等" class="headerlink" title="位运算符的妙用：奇偶数，色值换算，换值， 编码等"></a>位运算符的妙用：奇偶数，色值换算，换值， 编码等</h1><h2 id="位运算的基础知识"><a href="#位运算的基础知识" class="headerlink" title="位运算的基础知识"></a>位运算的基础知识</h2><ul>
<li>  操作数是<font color=red>32 位整数</font></li>
<li>  自动转为整数</li>
<li>  速度 T0 级别，在二进制下进行运算</li>
</ul>
<h2 id="1-按位与-amp"><a href="#1-按位与-amp" class="headerlink" title="1. 按位与 &amp;"></a>1. 按位与 &amp;</h2><ul>
<li>  两个为 1，则为 1，否则为 0</li>
</ul>
<table>
<thead>
<tr>
<th>a</th>
<th>b</th>
<th>a &amp; b</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody></table>
<h3 id="判断奇偶数"><a href="#判断奇偶数" class="headerlink" title="判断奇偶数"></a>判断奇偶数</h3><ul>
<li>  奇数：<code>num &amp; 1 == 1</code></li>
<li>  偶数：<code>num &amp; 1 == 0</code></li>
</ul>
<blockquote>
<p>二进制转换十进制：<code>b0 * 2 ^ 0 + b1 * 2 ^ 1 + b2 * 2 ^ 2 + b3 * 2 ^ 3 + ....</code></p>
</blockquote>
<h2 id="2-按位或"><a href="#2-按位或" class="headerlink" title="2. 按位或 |"></a>2. 按位或 |</h2><ul>
<li>  1 个为 1，则为 1</li>
</ul>
<table>
<thead>
<tr>
<th>a</th>
<th>b</th>
<th>a &amp; b</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody></table>
<h3 id="按位或-取整"><a href="#按位或-取整" class="headerlink" title="按位或 | 取整"></a>按位或 | 取整</h3><ul>
<li>  x | 0</li>
</ul>
<p>进行操作时，系统会将其变为整数进行二进制计算。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2.2 | 0</span><br><span class="line"></span><br><span class="line">    0 0 1 0</span><br><span class="line">|   0 0 0 0</span><br><span class="line">————————————</span><br><span class="line">    0 0 1 0</span><br></pre></td></tr></table></figure>

<ul>
<li>  自身 | 自身 = 自身，比较数值相等</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2 | 2 = 2</span><br><span class="line"></span><br><span class="line">    0 0 1 0</span><br><span class="line">|   0 0 1 0</span><br><span class="line">————————————</span><br><span class="line">    0 0 1 0</span><br></pre></td></tr></table></figure>

<h2 id="3-按位非"><a href="#3-按位非" class="headerlink" title="3. 按位非 ~"></a>3. 按位非 ~</h2><ul>
<li>  按位非运算符（~），反转操作数的位。表象的对数字求负，然后减 1。 <code>-x-1</code></li>
</ul>
<table>
<thead>
<tr>
<th>a</th>
<th>not a</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> 9 (base 10) = 00000000000000000000000000000000001001 (base 2)</span><br><span class="line">——————————————————————————————</span><br><span class="line">~9 (base 10) = 11111111111111111111111111111111110110 (base 2) = - 10 (base 10)</span><br></pre></td></tr></table></figure>

<h3 id="按位非-判断数组中是否包含某个元素"><a href="#按位非-判断数组中是否包含某个元素" class="headerlink" title="按位非 ~ 判断数组中是否包含某个元素"></a>按位非 ~ 判断数组中是否包含某个元素</h3><ul>
<li>  不存在， indexOf 返回-1</li>
<li>  <code>~ -1 = - ( -1 ) - 1 = 1 - 1 = 0</code> 为一个假值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( ~arr.indexOf(val) )&#123;</span><br><span class="line">    <span class="comment">// some code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>补充：类型更严谨的写法<br><code>!!</code>双感叹号可以将一个值转换为自身对应的布尔值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">!!<span class="literal">null</span> = <span class="literal">false</span></span><br><span class="line">!!<span class="literal">undefined</span> = <span class="literal">false</span></span><br><span class="line">!!(<span class="string">&#x27;&#x27;</span>) = <span class="literal">false</span></span><br><span class="line">!!<span class="number">100</span> = <span class="literal">true</span></span><br><span class="line">!!<span class="string">&#x27;str&#x27;</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!!~arr.indexOf(val))&#123;</span><br><span class="line">    <span class="comment">// some code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="按位非-取整"><a href="#按位非-取整" class="headerlink" title="按位非 ~ 取整"></a>按位非 ~ 取整</h3><ul>
<li>  <code>~~x</code></li>
<li>  位运算取整</li>
<li>  <code>- (-x - 1) - 1</code></li>
<li>  <code>x + 1 -1 = x</code></li>
</ul>
<h2 id="按位异或"><a href="#按位异或" class="headerlink" title="按位异或 ^"></a>按位异或 ^</h2><ul>
<li>  只有当一个数位为 1 时，返回 1，否则为 0</li>
</ul>
<table>
<thead>
<tr>
<th>a</th>
<th>b</th>
<th>a XOR b</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
</tbody></table>
<h3 id="异或的特殊定律"><a href="#异或的特殊定律" class="headerlink" title="异或的特殊定律"></a>异或的特殊定律</h3><ul>
<li>  归零律： <code>a ^ a = 0</code> 自己异或自己，位数上的值肯定相同</li>
<li>  <font color=red>恒等律</font>： <code>a ^ 0 = a</code> 自己异或 0，恒等于自己</li>
<li>  自反： <code>a ^ a ^ a = 0 ^ a = a</code></li>
<li>  结合律： <code>a ^ b ^ c == c ^ b ^ a</code></li>
</ul>
<h3 id="按位异或-值交换"><a href="#按位异或-值交换" class="headerlink" title="按位异或 ^ 值交换"></a>按位异或 ^ 值交换</h3><ul>
<li>  变量为数字，完成值的交换（不用增加临时变量）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">a ^= b</span><br><span class="line">b ^= a <span class="comment">// b = b ^ (a ^ b) = a ^ 0</span></span><br><span class="line">a ^= b <span class="comment">// a = (a ^ b) ^ a = b ^ 0</span></span><br></pre></td></tr></table></figure>

<h2 id="位移运算"><a href="#位移运算" class="headerlink" title="位移运算"></a>位移运算</h2><h3 id="RGB-转-16-进制"><a href="#RGB-转-16-进制" class="headerlink" title="RGB 转 16 进制"></a>RGB 转 16 进制</h3><ul>
<li>  基础知识</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RGB   255    255    255</span><br><span class="line">       ↓      ↓      ↓</span><br><span class="line"> #    FF     FF     FF</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">colorRGBToHex</span>(<span class="params">RGB</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// split 的参数可以是正则</span></span><br><span class="line">    <span class="comment">// &quot;rgb(204,0,255)</span></span><br><span class="line">    <span class="keyword">const</span> rgbArr = rgb.split(<span class="regexp">/[^\d]+/</span>)</span><br><span class="line">    <span class="comment">// [&#x27;&#x27;, &#x27;204&#x27;, &#x27;0&#x27;, &#x27;255&#x27;, &#x27;0&#x27;]</span></span><br><span class="line">    <span class="keyword">const</span> color = rgbArr[<span class="number">1</span>] &lt;&lt; <span class="number">16</span> | rgbArr[<span class="number">2</span>] &lt;&lt; <span class="number">8</span> | rgbArr[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;#&quot;</span> + color.toString(<span class="number">16</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/21/JavaScript%EF%BC%9A%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/4-3-1.png" alt="4-3-1"><br><img src="/2022/05/21/JavaScript%EF%BC%9A%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/4-3-2.png" alt="4-3-2"></p>
<h3 id="16-进制转-RGB"><a href="#16-进制转-RGB" class="headerlink" title="16 进制转 RGB"></a>16 进制转 RGB</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &quot;#CC00FF&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">colorHexToRGB</span>(<span class="params">hex</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 转为6位的16进制 0xCC00FF</span></span><br><span class="line">    <span class="keyword">let</span> newHex = hex.replace(<span class="string">&quot;#&quot;</span>,<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">    <span class="keyword">let</span> r = newHex &gt;&gt; <span class="number">16</span></span><br><span class="line">    <span class="keyword">let</span> g = newHex &gt;&gt; <span class="number">8</span> &amp; <span class="number">0xff</span></span><br><span class="line">    <span class="keyword">let</span> b = newHex &amp; <span class="number">0xff</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`rgb(<span class="subst">$&#123;r&#125;</span>,<span class="subst">$&#123;g&#125;</span>,<span class="subst">$&#123;b&#125;</span>)`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>先取前八位（R），向右移 16 位，即可以到 11001100。十进制：R(204)</li>
</ol>
<p><img src="/2022/05/21/JavaScript%EF%BC%9A%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/4-3-3.png" alt="4-3-3"></p>
<ol start="2">
<li><p>取中间（G），右移 8 位，然后 <code>&amp; 0xff(255)</code><br><img src="/2022/05/21/JavaScript%EF%BC%9A%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/4-3-4.png" alt="4-3-3"></p>
</li>
<li><p>去最后高位（B），直接 <code>&amp; 0xff(255)</code></p>
</li>
</ol>
<p><img src="/2022/05/21/JavaScript%EF%BC%9A%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/4-3-5.png" alt="4-3-3"></p>
<h3 id="位移运算应用场景"><a href="#位移运算应用场景" class="headerlink" title="位移运算应用场景"></a>位移运算应用场景</h3><ul>
<li>  base64 编码</li>
<li>  简单加密解密</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><table>
<thead>
<tr>
<th>符号</th>
<th>名称</th>
<th>特点</th>
<th>应用场景</th>
</tr>
</thead>
<tbody><tr>
<td>&amp;</td>
<td>按位与</td>
<td>两个操作数都为 1，则为 1</td>
<td>1.判断奇偶数</td>
</tr>
<tr>
<td>&#124;</td>
<td>按位或</td>
<td>两个操作数至少一个 1 为 1，则为 1</td>
<td>1.奇偶数 <br> 2.等于某个整数值</td>
</tr>
<tr>
<td>~</td>
<td>按位非</td>
<td>取反减 1， -x-1</td>
<td>1.取整 <br>2.数组中是否存在某个值</td>
</tr>
<tr>
<td>^</td>
<td>按位异或</td>
<td>有且只有一个操作数为 1，则为 1</td>
<td>1.整数比较 <br>2.数字交互</td>
</tr>
<tr>
<td>&gt;&gt;, &lt;&lt;</td>
<td>位移</td>
<td>移动指定位数，超出的位数将会被清除，缺省位则会补零</td>
<td>1.转为整数 <br>2.色值转换 <br>3.编码</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/21/JavaScript%EF%BC%9Adelete%E7%9A%84%E6%9C%AC%E8%B4%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/azem.png">
      <meta itemprop="name" content="Azem">
      <meta itemprop="description" content="记录些学习笔记，随便写写。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Azetus的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/21/JavaScript%EF%BC%9Adelete%E7%9A%84%E6%9C%AC%E8%B4%A8/" class="post-title-link" itemprop="url">JavaScript: 运算符</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-21 14:34:34" itemprop="dateCreated datePublished" datetime="2022-05-21T14:34:34+08:00">2022-05-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">JavaScript进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="关于赋值"><a href="#关于赋值" class="headerlink" title="关于赋值"></a>关于赋值</h1><h2 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h2><p>普通函数调用时，this 指向的是调用函数的对象，下面的四个操作会返回什么？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&quot;let的name&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;person的Name&quot;</span>,</span><br><span class="line">  <span class="function"><span class="title">getName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getName = person.getName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> print = <span class="function"><span class="keyword">function</span> (<span class="params">prefix, ...args</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(prefix.padEnd(<span class="number">20</span>, <span class="string">&quot; &quot;</span>) + <span class="string">&quot;:&quot;</span>, ...args)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;person.getName&quot;</span>, person.getName());</span><br><span class="line">print(<span class="string">&quot;getName&quot;</span>, getName());</span><br><span class="line">print(<span class="string">&quot;(person.getName)&quot;</span>, (person.getName)());</span><br><span class="line">print(<span class="string">&quot;(0, person.getName)&quot;</span>, (<span class="number">0</span>, person.getName)());</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">person.getName      : person的Name</span><br><span class="line">getName             : undefined</span><br><span class="line">(person.getName)    : person的Name</span><br><span class="line">(0, person.getName) : undefined</span><br></pre></td></tr></table></figure>

<h3 id="person-getName"><a href="#person-getName" class="headerlink" title="person.getName()"></a>person.getName()</h3><ul>
<li>  this:person</li>
<li>  结果：person 的 name</li>
</ul>
<h3 id="getName"><a href="#getName" class="headerlink" title="getName()"></a>getName()</h3><ul>
<li>  this：全局对象</li>
<li>  答案：undefined (let 和 const 声明的对象不会挂载全局对象)</li>
</ul>
<h3 id="person-getName-1"><a href="#person-getName-1" class="headerlink" title="(person.getName)()"></a>(person.getName)()</h3><ul>
<li>  有没有赋值操作？</li>
<li>  如果有的话赋值给了谁？</li>
</ul>
<h3 id="引用-Reference-Record"><a href="#引用-Reference-Record" class="headerlink" title="引用 Reference Record"></a>引用 Reference Record</h3><blockquote>
<p>tc39 ecma262:The Reference Record type is used to explain the behaviour of such operators as delete, typeof, the assignment operators, the super keyword and other language features. For example, the left-hand operand of an assignment is expected to produce a Reference Record.<br>A Reference Record is a resolved name or property binding</p>
</blockquote>
<ul>
<li>  被解析的命名绑定（resolved name binding）</li>
<li>  内部引用类型不是语言数据类型</li>
<li>  用于解释诸如 delete、typeof 和赋值等操作符的行为</li>
<li>  例如，赋值的<font color=red>左操作数</font>应该产生一个引用记录</li>
</ul>
<p>它由 4 部分组成</p>
<table>
<thead>
<tr>
<th>Field Name</th>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody><tr>
<td>Base</td>
<td>an ECMAScript language value, an Environment Record, or unresolvable</td>
<td>The value or Environment Record which holds the binding. A [[Base]] of unresolvable indicates that the binding could not be resolved.</td>
</tr>
<tr>
<td>ReferencedName</td>
<td>a String, a Symbol, or a Private Name</td>
<td>The name of the binding. Always a String if [[Base]] value is an Environment Record.</td>
</tr>
<tr>
<td>Strict</td>
<td>a Boolean</td>
<td>true if the Reference Record originated in strict mode code, false otherwise.</td>
</tr>
<tr>
<td>ThisValue</td>
<td>an ECMAScript language value or empty</td>
<td>If not empty, the Reference Record represents a property binding that was expressed using the super keyword; it is called a Super Reference Record and its [[Base]] value will never be an Environment Record. In that case, the [[ThisValue]] field holds the this value at the time the Reference Record was created.</td>
</tr>
</tbody></table>
<ul>
<li>  其表示的是对某个变量、数组元素或对象属性所在内存地址的引用，而非对其所在内存地址所保存值的引用。在 ECMAScript 中，赋值运算符的左侧只能是一个内存地址，而不能是一个值。（你可以把值保存在某个内存地址，而不能把值赋给另一个值）</li>
</ul>
<h4 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h4><ul>
<li>  <code>var Num =10</code></li>
<li>  <code>10 = 10</code></li>
</ul>
<h3 id="引用相关的两个重要操作"><a href="#引用相关的两个重要操作" class="headerlink" title="引用相关的两个重要操作"></a>引用相关的两个重要操作</h3><ul>
<li>  GetValue(V)：即取值操作，返回的是确定的值</li>
<li>  PutValue(V,W)：设置值，对某个引用设置</li>
<li>  PutValue <font color=red>要求第一个参数是引用</font></li>
</ul>
<h4 id="v-v"><a href="#v-v" class="headerlink" title="v = v"></a><code>v = v</code></h4><ul>
<li>  可以理解为：<code>v=GetValue(v)</code></li>
<li>  v 在左手端的时候，他是引用</li>
<li>  而 v 在右手端的时候，他是值</li>
</ul>
<h4 id="分组运算符"><a href="#分组运算符" class="headerlink" title="分组运算符()"></a>分组运算符()</h4><ul>
<li>  分组运算符里面可以是表达式，也可是字面量的值</li>
<li>  <font color=red>此算法不将 GetValue 应用于计算 Expression（表达式）的结果。这样做的主要原因是，诸如 delete 和 typeof 等操作符可以应用于括号表达式</font>（delete 的本质是删除引用）</li>
</ul>
<h3 id="person-getName-2"><a href="#person-getName-2" class="headerlink" title="(person.getName)()"></a>(person.getName)()</h3><ul>
<li>  没有产生 getValue 操作，没有发生取值操作，也没有赋值行为</li>
<li>  this：person</li>
<li>  答案：person 的 Name</li>
</ul>
<h3 id="0-person-getName"><a href="#0-person-getName" class="headerlink" title="(0, person.getName)()"></a>(0, person.getName)()</h3><ul>
<li>  分组运算符</li>
<li>  <font color=red>逗号运算符</font></li>
</ul>
<h4 id="逗号运算符"><a href="#逗号运算符" class="headerlink" title="逗号运算符"></a>逗号运算符</h4><ul>
<li>  MDN：对每个操作数<font color=red>求值</font>（从左到右），并返回最后一个操作数的值</li>
</ul>
<p>产生了复制操作，等同于<code>(const getName = person.Name)()</code></p>
<ul>
<li>  this：全局对象，window</li>
<li>  答案：undefined</li>
</ul>
<h4 id="typeof-未声明变量为什么不报错（非严格模式）"><a href="#typeof-未声明变量为什么不报错（非严格模式）" class="headerlink" title="typeof 未声明变量为什么不报错（非严格模式）"></a>typeof 未声明变量为什么不报错（非严格模式）</h4><ul>
<li>  引用不可达（unresolvable），直接返回 undefined</li>
</ul>
<hr>
<h1 id="delete-语法的本质"><a href="#delete-语法的本质" class="headerlink" title="delete 语法的本质"></a>delete 语法的本质</h1><p>先看一个例子:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;delete null     :&quot;</span>, <span class="keyword">delete</span> <span class="literal">null</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;delete 11       :&quot;</span>, <span class="keyword">delete</span> <span class="number">11</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;delete undefined:&quot;</span>, <span class="keyword">delete</span> <span class="literal">undefined</span>);</span><br><span class="line"></span><br><span class="line">a = &#123; <span class="attr">c</span>: <span class="number">12</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;delete a        :&quot;</span>, <span class="keyword">delete</span> a);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">12</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;delete b        :&quot;</span>, <span class="keyword">delete</span> b);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;delete xxxxxxxxx:&quot;</span>, <span class="keyword">delete</span> xxxxxxxxx);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = (&#123;&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;delete .toString:&quot;</span>, <span class="keyword">delete</span> obj.toString);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;obj.toString:&quot;</span>, obj.toString);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delete null     : true</span><br><span class="line">delete 11       : true</span><br><span class="line">delete undefined: false</span><br><span class="line">delete a        : true</span><br><span class="line">delete b        : false</span><br><span class="line">delete xxxxxxxxx: true</span><br><span class="line">delete .toString: true</span><br><span class="line">obj.toString: [Function: toString]</span><br></pre></td></tr></table></figure>

<h2 id="delete-的返回值是什么？"><a href="#delete-的返回值是什么？" class="headerlink" title="delete 的返回值是什么？"></a>delete 的返回值是什么？</h2><ul>
<li>  Boolean 类型</li>
<li>  true，并不代表删除成功，代表<font color=red>删除操作没有发生异常</font></li>
<li>  false，一定没有删除成功</li>
</ul>
<h2 id="delete-不能删除哪些属性"><a href="#delete-不能删除哪些属性" class="headerlink" title="delete 不能删除哪些属性"></a>delete 不能删除哪些属性</h2><ul>
<li>  任何用 var 声明的属性，不能从全局作用域或者函数作用域删除</li>
<li>  任何用 let 或者 const 声明的变量，不能从它声明的作用域删除</li>
<li>  不可配置（configurable: false）的属性不能被删除</li>
</ul>
<h2 id="delete-删除原型上的属性"><a href="#delete-删除原型上的属性" class="headerlink" title="delete 删除原型上的属性"></a>delete 删除原型上的属性</h2><ul>
<li>  delete 不会遍历原型链</li>
<li>  但是<code>delete Foo.prototype.bar</code>可以删除</li>
</ul>
<h2 id="delete-删除的到底是什么"><a href="#delete-删除的到底是什么" class="headerlink" title="delete 删除的到底是什么"></a>delete 删除的到底是什么</h2><ol>
<li>Let ref be the result of evaluating UnaryExpression.</li>
<li>ReturnIfAbrupt(ref).</li>
<li>If ref is not a Reference Record, return true.</li>
<li>If IsUnresolvableReference(ref) is true, then<br>a. Assert: ref.[[Strict]] is false.<br>b. Return true.</li>
<li>If IsPropertyReference(ref) is true, then<br>a. Assert: IsPrivateReference(ref) is false.<br>b. If IsSuperReference(ref) is true, throw a ReferenceError exception.<br>c. Let baseObj be ? ToObject(ref.[[Base]]).<br>d. Let deleteStatus be ? baseObj.<a href="ref.%5B%5BReferencedName%5D%5D">[Delete]</a>.<br>e. If deleteStatus is false and ref.[[Strict]] is true, throw a TypeError exception.<br>f. Return deleteStatus.</li>
<li>Else,<br>a. Let base be ref.[[Base]].<br>b. Assert: base is an Environment Record.<br>c. Return ? base.DeleteBinding(ref.[[ReferencedName]]).</li>
</ol>
<ul>
<li>  如果是常量和字面量，直接返回 true</li>
<li>  如果不可达（unResolvable），返回 true</li>
</ul>
<h2 id="delete-语法的本质是什么"><a href="#delete-语法的本质是什么" class="headerlink" title="delete 语法的本质是什么"></a>delete 语法的本质是什么</h2><ul>
<li>  删除的是操作表达式结果</li>
<li>  <font color=red>值，字面量</font> —— 不操作，直接返回 true</li>
<li>  <font color=red>引用类型</font>，删除引用</li>
</ul>
<blockquote>
<p>为何用 true 表示没有异常而不是操作成功：历史遗留问题，在 delete 推出时 JavaScript 还没要 try…catch 方法</p>
</blockquote>
<h2 id="严格模式"><a href="#严格模式" class="headerlink" title="严格模式"></a>严格模式</h2><p>非严格模式是安全的，但严格模式下有几种情况会抛出异常</p>
<ul>
<li>  SyntaxError：变量，函数名，函数参数</li>
<li>  TypeError：configurable: false</li>
<li>  ReferenceError：典型的就是 delete super.property</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/16/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%A1%B5%E7%A0%81%E6%A0%8F%E7%BB%84%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/azem.png">
      <meta itemprop="name" content="Azem">
      <meta itemprop="description" content="记录些学习笔记，随便写写。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Azetus的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/16/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%A1%B5%E7%A0%81%E6%A0%8F%E7%BB%84%E4%BB%B6/" class="post-title-link" itemprop="url">实现一个页码栏组件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-16 20:21:14" itemprop="dateCreated datePublished" datetime="2022-05-16T20:21:14+08:00">2022-05-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h1><p><img src="/2022/05/16/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%A1%B5%E7%A0%81%E6%A0%8F%E7%BB%84%E4%BB%B6/pageButtonGroup-1.png" alt="pageButtonGroup1"><br><img src="/2022/05/16/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%A1%B5%E7%A0%81%E6%A0%8F%E7%BB%84%E4%BB%B6/pageButtonGroup-2.png" alt="pageButtonGroup2"><br><img src="/2022/05/16/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%A1%B5%E7%A0%81%E6%A0%8F%E7%BB%84%E4%BB%B6/pageButtonGroup-3.png" alt="pageButtonGroup3"></p>
<ul>
<li>  样式如图</li>
</ul>
<ol>
<li>页码按钮最多显示 7 个</li>
<li>首尾按钮固定显示</li>
<li>若页码在中间则固定显示 5 个页码按钮，其余用省略号代替</li>
</ol>
<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>定义一个函数，该函数返回一个数组，数组元素是 JSX.Element，也就是我们想要 React 渲染出来的元素。当总页数大于 7 个的时候，数组的头尾必定是第一页和最后一页。然后我们根据当前页码来决定数组中间的内容以及省略号是否出现，使用循环或者其他方法，将这些元素添加到数组中。</p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><p>首先上最终结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &#x27;react&#x27;</span><br><span class="line">import &#x27;./Style/CreatePageStyle.css&#x27;</span><br><span class="line"></span><br><span class="line">const pageIdxBtnStyle = (isCurPage: boolean) =&gt; &#123;</span><br><span class="line">    return isCurPage</span><br><span class="line">        ? (&#123; color: &#x27;#FFFFFF&#x27;, border: &#x27;1px solid #3ABDCF&#x27;, background: &#x27;#3ABDCF&#x27; &#125; as React.CSSProperties)</span><br><span class="line">        : (&#123; color: &#x27;#DCDCDC&#x27;, border: &#x27;1px solid #DCDCDC&#x27; &#125; as React.CSSProperties)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const PageButtonGroup = () =&gt; &#123;</span><br><span class="line">    const [totalPage, setTotalPage] = useState(9)</span><br><span class="line">    const [curPage, setCurPage] = useState(0)</span><br><span class="line"></span><br><span class="line">    const CreatePage = () =&gt; &#123;</span><br><span class="line">        const pages = [] as JSX.Element[]</span><br><span class="line">        /* 页码按钮最多7个，省略号中间最多显示5个 */</span><br><span class="line">        const groupCount = 5</span><br><span class="line"></span><br><span class="line">        const handleClickPage = (idx: number) =&gt; &#123;</span><br><span class="line">            setCurPage(idx)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (totalPage &lt;= 7) &#123;</span><br><span class="line">            for (let i = 0; i &lt; totalPage; i++) &#123;</span><br><span class="line">                pages.push(</span><br><span class="line">                    &lt;li</span><br><span class="line">                        key=&#123;i.toString()&#125;</span><br><span class="line">                        className=&quot;pageButton&quot;</span><br><span class="line">                        style=&#123;pageIdxBtnStyle(i === curPage)&#125;</span><br><span class="line">                        onClick=&#123;() =&gt; handleClickPage(i)&#125;</span><br><span class="line">                    &gt;</span><br><span class="line">                        &#123;i + 1&#125;</span><br><span class="line">                    &lt;/li&gt;</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            pages.push(</span><br><span class="line">                &lt;li</span><br><span class="line">                    key=&#123;&#x27;0&#x27;&#125;</span><br><span class="line">                    className=&quot;pageButton&quot;</span><br><span class="line">                    style=&#123;pageIdxBtnStyle(curPage === 0)&#125;</span><br><span class="line">                    onClick=&#123;() =&gt; handleClickPage(0)&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                    1</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            )</span><br><span class="line">            const pageGroupStart = curPage &lt;= 3 ? 1 : totalPage - curPage &gt; 4 ? curPage - 2 : totalPage - groupCount - 1</span><br><span class="line">            const pageGroupEnd = groupCount + pageGroupStart &gt;= totalPage ? totalPage - 1 : groupCount + pageGroupStart</span><br><span class="line">            if (pageGroupStart &gt; 1)</span><br><span class="line">                pages.push(</span><br><span class="line">                    &lt;li key=&#123;&#x27;-1&#x27;&#125;&gt;</span><br><span class="line">                        &lt;p&gt;···&lt;/p&gt;</span><br><span class="line">                    &lt;/li&gt;</span><br><span class="line">                )</span><br><span class="line">            for (let i = pageGroupStart; i &lt; pageGroupEnd; i++) &#123;</span><br><span class="line">                if (i &lt; totalPage &amp;&amp; i &gt; 0)</span><br><span class="line">                    pages.push(</span><br><span class="line">                        &lt;li</span><br><span class="line">                            key=&#123;`$&#123;i&#125;-group`&#125;</span><br><span class="line">                            className=&quot;pageButton&quot;</span><br><span class="line">                            style=&#123;pageIdxBtnStyle(i === curPage)&#125;</span><br><span class="line">                            onClick=&#123;() =&gt; handleClickPage(i)&#125;</span><br><span class="line">                        &gt;</span><br><span class="line">                            &#123;i + 1&#125;</span><br><span class="line">                        &lt;/li&gt;</span><br><span class="line">                    )</span><br><span class="line">            &#125;</span><br><span class="line">            if (pageGroupEnd &lt; totalPage - 1)</span><br><span class="line">                pages.push(</span><br><span class="line">                    &lt;li key=&#123;&#x27;-2&#x27;&#125;&gt;</span><br><span class="line">                        &lt;p&gt;···&lt;/p&gt;</span><br><span class="line">                    &lt;/li&gt;</span><br><span class="line">                )</span><br><span class="line">            pages.push(</span><br><span class="line">                &lt;li</span><br><span class="line">                    key=&#123;totalPage.toString()&#125;</span><br><span class="line">                    className=&quot;pageButton&quot;</span><br><span class="line">                    style=&#123;pageIdxBtnStyle(curPage === totalPage - 1)&#125;</span><br><span class="line">                    onClick=&#123;() =&gt; handleClickPage(totalPage - 1)&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                    &#123;totalPage&#125;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">        return pages</span><br><span class="line">    &#125;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div style=&#123;&#123; display: &#x27;flex&#x27; &#125;&#125;&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">                className=&quot;nextPreButton&quot;</span><br><span class="line">                onClick=&#123;() =&gt; &#123;</span><br><span class="line">                    setCurPage((pre) =&gt; pre - 1)</span><br><span class="line">                &#125;&#125;</span><br><span class="line">            &gt;</span><br><span class="line">                &lt;img src=&#123;require(&#x27;./Style/Image/chevronLeft.png&#x27;)&#125; alt=&quot;leftArrow&quot; /&gt;</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;ul style=&#123;&#123; listStyle: &#x27;none&#x27;, display: &#x27;flex&#x27;, padding: 0 &#125;&#125;&gt;&#123;CreatePage()&#125;&lt;/ul&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">                className=&quot;nextPreButton&quot;</span><br><span class="line">                onClick=&#123;() =&gt; &#123;</span><br><span class="line">                    setCurPage((pre) =&gt; pre + 1)</span><br><span class="line">                &#125;&#125;</span><br><span class="line">            &gt;</span><br><span class="line">                &lt;img src=&#123;require(&#x27;component/Style/Image/chevronRight.png&#x27;)&#125; alt=&quot;rightArrow&quot; /&gt;</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>样式文件</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.pageButton</span> &#123;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">margin</span>: auto <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    user-select: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.nextPreButton</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">64px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">outline</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">background</span>: none;</span><br><span class="line">    user-select: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="定义所需要的状态"><a href="#定义所需要的状态" class="headerlink" title="定义所需要的状态"></a>定义所需要的状态</h2><p>首先定义一个 react 组件，作为整个按钮组的最外层，控制页码显示的 state 全部放在这里，对于按钮组我们只需要两个状态就可以控制，分别是总页数 totalPage 和当前页数 curPage，在实际使用时可以根据后端返回的数据以及页码实际展示情况进行初始化，或者在这里添加新的 state 进行控制（比如页面是一个列表情况）。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> PageButtonGroup = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [totalPage, setTotalPage] = useState(<span class="number">9</span>)</span><br><span class="line">    <span class="keyword">const</span> [curPage, setCurPage] = useState(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">display:</span> &#x27;<span class="attr">flex</span>&#x27; &#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加按钮样式"><a href="#添加按钮样式" class="headerlink" title="添加按钮样式"></a>添加按钮样式</h2><ul>
<li>  使用一个函数，来为当前页码添加特殊样式</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pageIdxBtnStyle = <span class="function">(<span class="params">isCurPage: boolean</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> isCurPage</span><br><span class="line">        ? (&#123; <span class="attr">color</span>: <span class="string">&#x27;#FFFFFF&#x27;</span>, <span class="attr">border</span>: <span class="string">&#x27;1px solid #3ABDCF&#x27;</span>, <span class="attr">background</span>: <span class="string">&#x27;#3ABDCF&#x27;</span> &#125; <span class="keyword">as</span> React.CSSProperties)</span><br><span class="line">        : (&#123; <span class="attr">color</span>: <span class="string">&#x27;#DCDCDC&#x27;</span>, <span class="attr">border</span>: <span class="string">&#x27;1px solid #DCDCDC&#x27;</span> &#125; <span class="keyword">as</span> React.CSSProperties)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加页面按钮组"><a href="#添加页面按钮组" class="headerlink" title="添加页面按钮组"></a>添加页面按钮组</h2><p>创建一个子组件 CreatePage，在子组件中创建一个列表 pages，列表中的元素是 JSX.Element，设想中我们将会根据当前页 i 的变化动态地创建这个数组来达到我们想要的结果。</p>
<ul>
<li>  首先我们考虑总页数小于 7 页的情况，这时不需要省略显示任何按钮，直接返回数组即可</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const CreatePage = () =&gt; &#123;</span><br><span class="line">    const pages = [] as JSX.Element[]</span><br><span class="line">    /* 页码按钮最多7个，省略号中间最多显示5个 */</span><br><span class="line">    const groupCount = 5</span><br><span class="line"></span><br><span class="line">    const handleClickPage = (idx: number) =&gt; &#123;</span><br><span class="line">        setCurPage(idx)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (totalPage &lt;= 7) &#123;</span><br><span class="line">        for (let i = 0; i &lt; totalPage; i++) &#123;</span><br><span class="line">            pages.push(</span><br><span class="line">                &lt;li</span><br><span class="line">                    key=&#123;i.toString()&#125;</span><br><span class="line">                    className=&quot;pageButton&quot;</span><br><span class="line">                    style=&#123;pageIdxBtnStyle(i === curPage)&#125;</span><br><span class="line">                    onClick=&#123;() =&gt; handleClickPage(i)&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                    &#123;i + 1&#125;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        /**</span><br><span class="line">         * 页码总数大于七个时？</span><br><span class="line">         */</span><br><span class="line">    &#125;</span><br><span class="line">    return pages</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>若当页面总数大于 7 个时，就需要对当前页码进行判断<ul>
<li>  首先首尾的按钮是必定会显示的，先将页码 1 的元素 push 进数组中</li>
<li>  再根据页码 i 计算出中间需要显示的 5 个页码的头和尾</li>
<li>  如果头大于 1 或者尾小于 total-1，则需要添加省略号</li>
<li>  在中间使用 for 循环将页码组的元素 push 进数组中</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">if (totalPage &lt;= 7) &#123;</span><br><span class="line">    // ...</span><br><span class="line">    // ...</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    pages.push(</span><br><span class="line">        &lt;li key=&#123;&#x27;0&#x27;&#125; className=&quot;pageButton&quot; style=&#123;pageIdxBtnStyle(curPage === 0)&#125; onClick=&#123;() =&gt; handleClickPage(0)&#125;&gt;</span><br><span class="line">            1</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    )</span><br><span class="line">    const pageGroupStart = curPage &lt;= 3 ? 1 : totalPage - curPage &gt; 4 ? curPage - 2 : totalPage - groupCount - 1</span><br><span class="line">    const pageGroupEnd = groupCount + pageGroupStart &gt;= totalPage ? totalPage - 1 : groupCount + pageGroupStart</span><br><span class="line">    if (pageGroupStart &gt; 1)</span><br><span class="line">        pages.push(</span><br><span class="line">            &lt;li key=&#123;&#x27;-1&#x27;&#125;&gt;</span><br><span class="line">                &lt;p&gt;···&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        )</span><br><span class="line">    for (let i = pageGroupStart; i &lt; pageGroupEnd; i++) &#123;</span><br><span class="line">        if (i &lt; totalPage &amp;&amp; i &gt; 0)</span><br><span class="line">            pages.push(</span><br><span class="line">                &lt;li</span><br><span class="line">                    key=&#123;`$&#123;i&#125;-group`&#125;</span><br><span class="line">                    className=&quot;pageButton&quot;</span><br><span class="line">                    style=&#123;pageIdxBtnStyle(i === curPage)&#125;</span><br><span class="line">                    onClick=&#123;() =&gt; handleClickPage(i)&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                    &#123;i + 1&#125;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line">    if (pageGroupEnd &lt; totalPage - 1)</span><br><span class="line">        pages.push(</span><br><span class="line">            &lt;li key=&#123;&#x27;-2&#x27;&#125;&gt;</span><br><span class="line">                &lt;p&gt;···&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        )</span><br><span class="line">    pages.push(</span><br><span class="line">        &lt;li</span><br><span class="line">            key=&#123;totalPage.toString()&#125;</span><br><span class="line">            className=&quot;pageButton&quot;</span><br><span class="line">            style=&#123;pageIdxBtnStyle(curPage === totalPage - 1)&#125;</span><br><span class="line">            onClick=&#123;() =&gt; handleClickPage(totalPage - 1)&#125;</span><br><span class="line">        &gt;</span><br><span class="line">            &#123;totalPage&#125;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="最后添加翻页按钮"><a href="#最后添加翻页按钮" class="headerlink" title="最后添加翻页按钮"></a>最后添加翻页按钮</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> PageButtonGroup = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [totalPage, setTotalPage] = useState(<span class="number">9</span>)</span><br><span class="line">    <span class="keyword">const</span> [curPage, setCurPage] = useState(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> CreatePage = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> pages = [] <span class="keyword">as</span> JSX.Element[]</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">return</span> pages</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">display:</span> &#x27;<span class="attr">flex</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">className</span>=<span class="string">&quot;nextPreButton&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                    setCurPage((pre) =&gt; pre - 1)</span></span><br><span class="line"><span class="xml">                &#125;&#125;</span></span><br><span class="line"><span class="xml">            &gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;require(</span>&#x27;<span class="attr">.</span>/<span class="attr">Style</span>/<span class="attr">Image</span>/<span class="attr">chevronLeft.png</span>&#x27;)&#125; <span class="attr">alt</span>=<span class="string">&quot;leftArrow&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">listStyle:</span> &#x27;<span class="attr">none</span>&#x27;, <span class="attr">display:</span> &#x27;<span class="attr">flex</span>&#x27;, <span class="attr">padding:</span> <span class="attr">0</span> &#125;&#125;&gt;</span>&#123;CreatePage()&#125;<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">className</span>=<span class="string">&quot;nextPreButton&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                    setCurPage((pre) =&gt; pre + 1)</span></span><br><span class="line"><span class="xml">                &#125;&#125;</span></span><br><span class="line"><span class="xml">            &gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;require(</span>&#x27;<span class="attr">component</span>/<span class="attr">Style</span>/<span class="attr">Image</span>/<span class="attr">chevronRight.png</span>&#x27;)&#125; <span class="attr">alt</span>=<span class="string">&quot;rightArrow&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/08/JavaScript%EF%BC%9A%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8B%B7%E8%B4%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/azem.png">
      <meta itemprop="name" content="Azem">
      <meta itemprop="description" content="记录些学习笔记，随便写写。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Azetus的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/08/JavaScript%EF%BC%9A%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8B%B7%E8%B4%9D/" class="post-title-link" itemprop="url">JavaScript：对象的拷贝</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-08 19:56:44" itemprop="dateCreated datePublished" datetime="2022-05-08T19:56:44+08:00">2022-05-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">JavaScript进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="对象的浅拷贝"><a href="#对象的浅拷贝" class="headerlink" title="对象的浅拷贝"></a>对象的浅拷贝</h1><ul>
<li>  只克隆对象的第一层级</li>
<li>  如果属性值时原始数据类型，拷贝其值，也就是我们常说的值拷贝</li>
<li>  如果属性值是引用类型，拷贝其内存地址，也就是我们常说的引用拷贝</li>
</ul>
<h2 id="常用的浅拷贝"><a href="#常用的浅拷贝" class="headerlink" title="常用的浅拷贝"></a>常用的浅拷贝</h2><ul>
<li>  ES6 扩展运算符<code>&#123;...obj&#125;</code></li>
<li>  <code>Object.assign(&#123;&#125;, obj)</code></li>
<li>  <code>for...in</code>和其他的一层遍历复制</li>
</ul>
<h2 id="数组常用的浅拷贝"><a href="#数组常用的浅拷贝" class="headerlink" title="数组常用的浅拷贝"></a>数组常用的浅拷贝</h2><ul>
<li>  ES6 扩展运算符<code>[...arr]</code></li>
<li>  <code>arr.slice(0)</code></li>
<li>  <code>[].concat(arr)</code></li>
</ul>
<h1 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h1><ul>
<li>  克隆对象的每个层级</li>
<li>  如果属性值是原始数据类型，拷贝其值，也就是我们常说的值拷贝</li>
<li>  如果属性值是引用类型，递归克隆</li>
</ul>
<h1 id="方法-1-SON-parse-JSON-stringify"><a href="#方法-1-SON-parse-JSON-stringify" class="headerlink" title="方法 1 SON.parse + JSON.stringify"></a>方法 1 SON.parse + JSON.stringify</h1><p>利用 JSON 对象方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clone</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  优点：原生方法，简单易用</li>
<li>局限性：<ul>
<li>  只能复制普通键的属性，Symbol 类型无能为力</li>
<li>  循环引用对象，比如 Window 不能复制</li>
<li>  特殊值类型，函数、Date、Rege、Blob 等类型不能复制</li>
<li>  性能差</li>
</ul>
</li>
</ul>
<h1 id="方法-2-消息通讯"><a href="#方法-2-消息通讯" class="headerlink" title="方法 2 消息通讯"></a>方法 2 消息通讯</h1><p>消息通讯 - BroadcastChannel 等</p>
<ul>
<li>  window.postMessage</li>
<li>  BroadcastChannel</li>
<li>  Shared Worker</li>
<li>  Message Channel</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> chId = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clone</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    chId++</span><br><span class="line">    <span class="keyword">var</span> cname = <span class="string">`__clone__<span class="subst">$&#123;chId&#125;</span>`</span></span><br><span class="line">    <span class="keyword">var</span> ch1 = <span class="keyword">new</span> BroadcastChannel(cname)</span><br><span class="line">    <span class="keyword">var</span> ch2 = <span class="keyword">new</span> BroadcastChannel(cname)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        ch2.addEventListener(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">ev</span>) =&gt;</span> resolve(ev.data), &#123; <span class="attr">once</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">        ch1.postMessage(data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>局限性：<ul>
<li>  循环引用对象，比如 Window 不能复制</li>
<li>  不能复制函数</li>
<li>  同步变成异步</li>
</ul>
</li>
</ul>
<h1 id="方法-3-structuredClone"><a href="#方法-3-structuredClone" class="headerlink" title="方法 3 structuredClone()"></a>方法 3 structuredClone()</h1><blockquote>
<p>structuredClone(value)<br>structuredClone(value, { transfer })</p>
</blockquote>
<p>参数:</p>
<ul>
<li><p>value</p>
<blockquote>
<p>被克隆的对象。可以是任何结构化克隆支持的类型。</p>
</blockquote>
</li>
<li><p>transfer 可选</p>
<blockquote>
<p>是一个 transferable objects (en-US) (可转移对象)的数组，里面的 值 并没有被克隆，而是被转移到被拷贝对象上。</p>
</blockquote>
</li>
</ul>
<p>局限性：</p>
<ul>
<li>  这是一个新的 API，从兼容性角度考虑，旧版浏览器不支持</li>
<li>  Error 以及 Function 对象是不能被复制的，会抛出抛出的异常</li>
<li>  DOM 节点同样无法复制</li>
<li>对象的某些特定参数也不会被保留<ul>
<li>  RegExp 对象的 lastIndex 字段不会被保留</li>
<li>  属性描述符，setters 以及 getters（以及其他类似元数据的功能）同样不会被复制。例如，如果一个对象用属性描述符标记为 read-only，它将会被复制为 read-write，因为这是默认的情况下。</li>
<li>  原形链上的属性也不会被追踪以及复制。</li>
</ul>
</li>
</ul>
<h1 id="方法-4"><a href="#方法-4" class="headerlink" title="方法 4"></a>方法 4</h1><p>自己实现</p>
<ol>
<li>递归版本</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">target, hash = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (target === <span class="literal">null</span>) <span class="keyword">return</span> target</span><br><span class="line">    <span class="keyword">if</span> (target <span class="keyword">instanceof</span> <span class="built_in">Date</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(target)</span><br><span class="line">    <span class="keyword">if</span> (target <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">RegExp</span>(target)</span><br><span class="line">    <span class="keyword">if</span> (target <span class="keyword">instanceof</span> HTMLElement) <span class="keyword">return</span> target</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">&#x27;object&#x27;</span>) <span class="keyword">return</span> target</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hash.get(target)) <span class="keyword">return</span> hash.get(target)</span><br><span class="line">    <span class="keyword">const</span> cloneTarget = <span class="keyword">new</span> target.constructor()</span><br><span class="line">    hash.set(target, cloneTarget)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (target <span class="keyword">instanceof</span> <span class="built_in">Map</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> target) &#123;</span><br><span class="line">            cloneTarget.set(key, deepClone(value, hash))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cloneTarget</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (target <span class="keyword">instanceof</span> <span class="built_in">Set</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> target) &#123;</span><br><span class="line">            cloneTarget.add(deepClone(value, hash))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cloneTarget</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Reflect</span>.ownKeys(target).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 引入 Reflect.ownKeys，处理 Symbol 作为键名的情况</span></span><br><span class="line">        cloneTarget[key] = deepClone(target[key], hash) <span class="comment">// 递归拷贝每一层</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> cloneTarget</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>循环版本</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; toString, hasOwnProperty &#125; = <span class="built_in">Object</span>.prototype</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hasOwnProp</span>(<span class="params">obj, property</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> hasOwnProperty.call(obj, property)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getType</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> toString.call(obj).slice(<span class="number">8</span>, -<span class="number">1</span>).toLowerCase()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getType(obj) === <span class="string">&#x27;object&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isArray</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getType(arr) === <span class="string">&#x27;array&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isCloneObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isObject(obj) || isArray(obj)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cloneDeep</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//使用WeakMap</span></span><br><span class="line">    <span class="keyword">let</span> uniqueData = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span><br><span class="line">    <span class="keyword">let</span> root = x</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isArray(x)) &#123;</span><br><span class="line">        root = []</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isObject(x)) &#123;</span><br><span class="line">        root = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环数组</span></span><br><span class="line">    <span class="keyword">const</span> loopList = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">parent</span>: root,</span><br><span class="line">            <span class="attr">key</span>: <span class="literal">undefined</span>,</span><br><span class="line">            <span class="attr">data</span>: x</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (loopList.length) &#123;</span><br><span class="line">        <span class="comment">// 深度优先</span></span><br><span class="line">        <span class="keyword">const</span> node = loopList.pop()</span><br><span class="line">        <span class="keyword">const</span> parent = node.parent</span><br><span class="line">        <span class="keyword">const</span> key = node.key</span><br><span class="line">        <span class="keyword">const</span> source = node.data</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化赋值目标，key为undefined则拷贝到父元素，否则拷贝到子元素</span></span><br><span class="line">        <span class="keyword">let</span> target = parent</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> key !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">            target = parent[key] = isArray(source) ? [] : &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 复杂数据需要缓存操作</span></span><br><span class="line">        <span class="keyword">if</span> (isCloneObject(source)) &#123;</span><br><span class="line">            <span class="comment">// 命中缓存，直接返回缓存数据</span></span><br><span class="line">            <span class="keyword">let</span> uniqueTarget = uniqueData.get(source)</span><br><span class="line">            <span class="keyword">if</span> (uniqueTarget) &#123;</span><br><span class="line">                parent[key] = uniqueTarget</span><br><span class="line">                <span class="keyword">continue</span> <span class="comment">// 中断本次循环</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 未命中缓存，保存到缓存</span></span><br><span class="line">            uniqueData.set(source, target)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isArray(source)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; source.length; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isCloneObject(source[i])) &#123;</span><br><span class="line">                    <span class="comment">// 下一次循环</span></span><br><span class="line">                    loopList.push(&#123;</span><br><span class="line">                        <span class="attr">parent</span>: target,</span><br><span class="line">                        <span class="attr">key</span>: i,</span><br><span class="line">                        <span class="attr">data</span>: source[i]</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    target[i] = source[i]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isObject(source)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> source) &#123;</span><br><span class="line">                <span class="keyword">if</span> (hasOwnProp(source, k)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (isCloneObject(source[k])) &#123;</span><br><span class="line">                        <span class="comment">// 下一次循环</span></span><br><span class="line">                        loopList.push(&#123;</span><br><span class="line">                            <span class="attr">parent</span>: target,</span><br><span class="line">                            <span class="attr">key</span>: k,</span><br><span class="line">                            <span class="attr">data</span>: source[k]</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        target[k] = source[k]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    uniqueData = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="方法-5"><a href="#方法-5" class="headerlink" title="方法 5"></a>方法 5</h1><p>引入 lodash 等工具库</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/08/JavaScript%EF%BC%9AJSON%20%E4%B8%8E%20JavaScript%20%E5%AF%B9%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/azem.png">
      <meta itemprop="name" content="Azem">
      <meta itemprop="description" content="记录些学习笔记，随便写写。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Azetus的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/08/JavaScript%EF%BC%9AJSON%20%E4%B8%8E%20JavaScript%20%E5%AF%B9%E8%B1%A1/" class="post-title-link" itemprop="url">JavaScript：JSON 与 JavaScript 对象</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-08 18:44:42" itemprop="dateCreated datePublished" datetime="2022-05-08T18:44:42+08:00">2022-05-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">JavaScript进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="JSON-对象"><a href="#JSON-对象" class="headerlink" title="JSON 对象"></a>JSON 对象</h1><ul>
<li>  严格意义上 JSON 是一种文本协议</li>
<li>  而 JS 环境中全局作用域下，指名为 JSON 的 Object 对象</li>
</ul>
<p>以下对象时 JSON 对象么？</p>
<blockquote>
<p>不是，这是一个对象字面量，JSON 与 JS 对象不同，JSON 键值只能是字符串</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;tom&#x27;</span>,</span><br><span class="line">    [<span class="built_in">Symbol</span>.for(<span class="string">&#x27;sex&#x27;</span>)]: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="JSON-格式"><a href="#JSON-格式" class="headerlink" title="JSON 格式"></a>JSON 格式</h1><ul>
<li>  JSON 是一种轻量级的、<font color=red>基于文本的</font>、与语言无关的语法，用于定义数据交换格式</li>
<li>  他来源于 ECMAScript，但是独立于编程语言</li>
</ul>
<h1 id="JSON-特征"><a href="#JSON-特征" class="headerlink" title="JSON 特征"></a>JSON 特征</h1><ul>
<li>  JSON 本质就是一串<font color=red>字符串</font>，使用特定的符号标注</li>
<li>  <code>&#123;&#125;</code>表示对象</li>
<li>  <code>[]</code>表示数组</li>
<li>  <code>&quot;&quot;</code>双引号内是属性键或值</li>
</ul>
<h2 id="JSON-键"><a href="#JSON-键" class="headerlink" title="JSON 键"></a>JSON 键</h2><ul>
<li>  只能是字符串</li>
<li>  <strong>必须</strong>用双引号包裹</li>
</ul>
<h2 id="JSON-值"><a href="#JSON-值" class="headerlink" title="JSON 值"></a>JSON 值</h2><p>只能包括以下值</p>
<ol>
<li>Object</li>
<li>Array</li>
<li>Number (只能是十进制)</li>
<li>String</li>
<li>true</li>
<li>false</li>
<li>null</li>
</ol>
<h1 id="JSON-parse"><a href="#JSON-parse" class="headerlink" title="JSON.parse()"></a>JSON.parse()</h1><blockquote>
<p><code>JSON.parse(text[, reviver])</code></p>
</blockquote>
<ul>
<li>  第二个参数函数(可选) <code>reviver(key, value)</code></li>
<li>  key -&gt; 当前转换的属性键</li>
<li>  value -&gt; 当前转换的属性值</li>
<li>如果 reviver 返回 undefined，则当前属性会从所属对象中删除，如果返回了其他值，则返回的值会成为当前属性新的属性值<blockquote>
<p>可以用来过滤数据，拦截一些不想通过网络传输或存储的数据。</p>
</blockquote>
</li>
<li>遍历顺序：从最最里层的属性开始，一级级往外，最终到达顶层，也就是解析值本身<blockquote>
<p>对于深层对象，遇到子对象时，先遍历解析子对象的属性，再解析子对象自身<br>当遍历到最顶层的值（解析值）时，传入 reviver 函数的 key 参数会是空字符串 “” 和当前的解析值（有可能已经被修改过了），当前的 this 值会是 {“”: 修改过的解析值}</p>
</blockquote>
</li>
<li>  this：在调用过程中，当前属性所属的对象会作为 this 值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonStr = <span class="string">`&#123;</span></span><br><span class="line"><span class="string">    &quot;1&quot;: 1,</span></span><br><span class="line"><span class="string">    &quot;2&quot;: 2,</span></span><br><span class="line"><span class="string">    &quot;3&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;4&quot;: 4,</span></span><br><span class="line"><span class="string">        &quot;5&quot;: 5,</span></span><br><span class="line"><span class="string">        &quot;6&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;7&quot;: 7</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;`</span></span><br><span class="line"><span class="built_in">JSON</span>.parse(jsonStr, <span class="function"><span class="keyword">function</span> (<span class="params">k, v</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(k)</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>输出顺序为：1 2 4 5 7 6 3 “”</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(obj, <span class="function"><span class="keyword">function</span> (<span class="params">k, v</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;key:&#x27;</span>, k, <span class="string">&#x27;,this:&#x27;</span>, <span class="built_in">this</span>)</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;key:&quot; &quot;1&quot; &quot;,this:&quot; Object &#123; 1: 1, 2: 2, 3: Object &#123; 4: 4, 5: 5, 6: Object &#123; 7: 7 &#125; &#125; &#125;</span><br><span class="line">&quot;key:&quot; &quot;2&quot; &quot;,this:&quot; Object &#123; 1: 1, 2: 2, 3: Object &#123; 4: 4, 5: 5, 6: Object &#123; 7: 7 &#125; &#125; &#125;</span><br><span class="line">&quot;key:&quot; &quot;4&quot; &quot;,this:&quot; Object &#123; 4: 4, 5: 5, 6: Object &#123; 7: 7 &#125; &#125;</span><br><span class="line">&quot;key:&quot; &quot;5&quot; &quot;,this:&quot; Object &#123; 4: 4, 5: 5, 6: Object &#123; 7: 7 &#125; &#125;</span><br><span class="line">&quot;key:&quot; &quot;7&quot; &quot;,this:&quot; Object &#123; 7: 7 &#125;</span><br><span class="line">&quot;key:&quot; &quot;6&quot; &quot;,this:&quot; Object &#123; 4: 4, 5: 5, 6: Object &#123; 7: 7 &#125; &#125;</span><br><span class="line">&quot;key:&quot; &quot;3&quot; &quot;,this:&quot; Object &#123; 1: 1, 2: 2, 3: Object &#123; 4: 4, 5: 5, 6: Object &#123; 7: 7 &#125; &#125; &#125;</span><br><span class="line">&quot;key:&quot; &quot;&quot; &quot;,this:&quot; Object &#123; : Object &#123; 1: 1, 2: 2, 3: Object &#123; 4: 4, 5: 5, 6: Object &#123; 7: 7 &#125; &#125; &#125; &#125;</span><br></pre></td></tr></table></figure>

<h1 id="JSON-stringify"><a href="#JSON-stringify" class="headerlink" title="JSON.stringify()"></a>JSON.stringify()</h1><blockquote>
<p><code>JSON.stringify(value[, replacer [, space]])</code></p>
</blockquote>
<ul>
<li>第二个参数(可选) replacer：过滤属性或处理值<blockquote>
<p>replacer?: (this: any, key: string, value: any) =&gt; any<br>replacer?: (number | string)[] | null</p>
</blockquote>
</li>
<li>第三个参数(可选) space：美化输出格式<blockquote>
<p>space?: string | number | null</p>
</blockquote>
</li>
</ul>
<p>以如下对象为例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Azetus&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">27</span>,</span><br><span class="line">    <span class="attr">birth</span>: <span class="string">&#x27;1995&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第二个参数-replacer"><a href="#第二个参数-replacer" class="headerlink" title="第二个参数 replacer"></a>第二个参数 replacer</h2><ul>
<li>  如果该参数是一个函数：则在序列化过程中，被序列化的值的每个属性都会经过该函数的转换和处理；</li>
<li>  如果改参数是一个数组，则只有包含在这个数组中的属性名才会被序列化到最终的 JSON 字符串中；</li>
<li>  如果该参数为 null 或者未提供，则对象所有的属性都会被序列化。</li>
</ul>
<h3 id="传入函数"><a href="#传入函数" class="headerlink" title="传入函数"></a>传入函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonString = <span class="built_in">JSON</span>.stringify(person, <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(jsonString)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;age&quot;:27&#125;</span><br></pre></td></tr></table></figure>

<h3 id="传入数组"><a href="#传入数组" class="headerlink" title="传入数组"></a>传入数组</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(person, [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;Azetus&quot;,&quot;age&quot;:27&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第三个参数-space"><a href="#第三个参数-space" class="headerlink" title="第三个参数 space"></a>第三个参数 space</h2><ul>
<li>  如果参数是个数字：它代表有多少的空格；上限为 10，该值若小于 1，则意味着没有空格；</li>
<li>  如果该参数为字符串（当字符串长度超过 10 个字母，取其前 10 个字母），该字符串将被作为空格；</li>
<li>  如果该参数没有提供（或者为 null），将没有空格。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="built_in">JSON</span>.stringify(person)</span><br><span class="line"><span class="built_in">console</span>.log(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;Azetus&quot;,&quot;age&quot;:27,&quot;birth&quot;:&quot;1995&quot;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> c = <span class="built_in">JSON</span>.stringify(person, <span class="literal">null</span>, <span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(c)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;name&quot;: &quot;Azetus&quot;,</span><br><span class="line">	&quot;age&quot;: 27,</span><br><span class="line">	&quot;birth&quot;: &quot;1995&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="转换规则-undefined-Symbol-function"><a href="#转换规则-undefined-Symbol-function" class="headerlink" title="转换规则 - undefined, Symbol, function"></a>转换规则 - undefined, Symbol, function</h2><ul>
<li>  作为对象属性值，自动忽略</li>
<li>  作为数组，序列化返回 null</li>
<li>  单独序列化时，返回 undefined</li>
</ul>
<h2 id="其他转换规则"><a href="#其他转换规则" class="headerlink" title="其他转换规则"></a>其他转换规则</h2><ul>
<li>  Date 返回 ISO 字符串</li>
<li>  循环引用会报错</li>
<li>  NaN, Infinity, null 都会作为 null</li>
<li>  BigInt 报错</li>
<li>  Map, Set, WeakMap 等对象，仅序列化可枚举属性</li>
</ul>
<h2 id="toJSON"><a href="#toJSON" class="headerlink" title="toJSON"></a>toJSON</h2><p>如果对象拥有<code>toJSON</code>方法，<code>toJSON</code>会覆盖对象默认的序列化行为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> product = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;牙膏&#x27;</span>,</span><br><span class="line">    <span class="attr">count</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">orderDetail</span>: &#123;</span><br><span class="line">        <span class="attr">createTime</span>: <span class="number">1632996519781</span>,</span><br><span class="line">        <span class="attr">orderId</span>: <span class="number">8632996519781</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">toJSON</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;牙膏&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(product))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#123;&quot;name&quot;:&quot;牙膏&quot;&#125;&#x27;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/08/JavaScript%EF%BC%9A%E6%90%9E%E6%87%82%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%9A%90%E5%BC%8F%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/azem.png">
      <meta itemprop="name" content="Azem">
      <meta itemprop="description" content="记录些学习笔记，随便写写。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Azetus的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/08/JavaScript%EF%BC%9A%E6%90%9E%E6%87%82%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%9A%90%E5%BC%8F%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/" class="post-title-link" itemprop="url">JavaScript：搞懂对象的隐式类型转换</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-08 18:14:46" itemprop="dateCreated datePublished" datetime="2022-05-08T18:14:46+08:00">2022-05-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">JavaScript进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="显式类型转换"><a href="#显式类型转换" class="headerlink" title="显式类型转换"></a>显式类型转换</h1><ul>
<li>  显式转换：通过 JS 定义的转换方式进行转换</li>
<li>  String, Object 等</li>
<li>  parseInt, parseFloat 等</li>
<li>  显式 toString</li>
</ul>
<h1 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h1><ul>
<li>  隐式转换：编译器自动完成类型转换的方式就称为隐式转换</li>
<li>  总是<font color=red>期望</font>返回基本类型值</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[] + &#x27;&#x27;</span><br><span class="line">!&#x27;str&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="什么时候会发生隐式类型转换"><a href="#什么时候会发生隐式类型转换" class="headerlink" title="什么时候会发生隐式类型转换"></a>什么时候会发生隐式类型转换</h1><ul>
<li>  二元<code>+</code>运算符</li>
<li>  关系运算符<code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>==</code></li>
<li>  逻辑运算符<code>!</code>, <code>if/while</code>, 三目条件</li>
<li>  属性键遍历，<code>for...in</code>等</li>
<li>  模板字符串</li>
</ul>
<blockquote>
<p>预期的数据类型和传入的数据类型不一致的时候</p>
</blockquote>
<p>一个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">toString</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.value + <span class="number">10</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">valueOf</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj[obj] = obj.value</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;keys:&#x27;</span>, <span class="built_in">Object</span>.keys(obj))</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;$&#123;obj&#125;:&#x27;</span>, <span class="string">`<span class="subst">$&#123;obj&#125;</span>`</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;obj + 1:&#x27;</span>, obj + <span class="number">1</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;obj + &quot;&quot;:&#x27;</span>, obj + <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    keys: [ &#x27;20&#x27;, &#x27;value&#x27;, &#x27;toString&#x27;, &#x27;valueOf&#x27; ]</span></span><br><span class="line"><span class="comment">    $&#123;obj&#125;: 20</span></span><br><span class="line"><span class="comment">    obj + 1: 11</span></span><br><span class="line"><span class="comment">    obj + &quot;&quot;: 10</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h1 id="对象隐式转换三大扛把子"><a href="#对象隐式转换三大扛把子" class="headerlink" title="对象隐式转换三大扛把子"></a>对象隐式转换三大扛把子</h1><ul>
<li>  <code>Symbol.toPrimitive</code></li>
<li>  <code>Object.prototype.valueOf</code></li>
<li>  <code>Object.prototype.toString</code></li>
</ul>
<h1 id="对象隐式转换规则"><a href="#对象隐式转换规则" class="headerlink" title="对象隐式转换规则"></a>对象隐式转换规则</h1><ul>
<li>  如果<code>[Symbol.toPrimitive](hint)</code>存在，优先调用，无视<code>valueOf</code>和<code>toString</code>方法</li>
<li>  否则，如果期望值是 <font color=red>“string”</font> —— 先调用<code>obj.toString()</code>如果返回不是原始值，继续调用<code>obj.valueOf()</code></li>
<li>  否则，如果期望值是<font color=red>“number”</font>或<font color=red>“default”</font> —— 先调用<code>obj.valueOf()</code>如果返回不是原始值，继续调用<code>obj.toString()</code></li>
</ul>
<h2 id="一个问题"><a href="#一个问题" class="headerlink" title="一个问题"></a>一个问题</h2><ul>
<li>如果未定义<code>[Symbol.toPrimitive]</code>，期望值是”string”,而<code>toString()</code>与<code>valueOf()</code>都没返回原始值？<blockquote>
<p>抛出异常</p>
</blockquote>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="function"><span class="title">valueOf</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">10</span> + obj)</span><br><span class="line"><span class="comment">// TypeError: Cannot convert object to primitive value</span></span><br></pre></td></tr></table></figure>

<h1 id="Symbol-toPrimitive-hint"><a href="#Symbol-toPrimitive-hint" class="headerlink" title="[Symbol.toPrimitive](hint)"></a><code>[Symbol.toPrimitive](hint)</code></h1><blockquote>
<p>hint 参数并非手动输入，而是引擎根据上下文自行判断（最初为 default，之后根据推断设定）</p>
</blockquote>
<ul>
<li>  hint - “string”</li>
<li>  hint - “number”</li>
<li>  hint - “default”</li>
</ul>
<h2 id="hint-“string”"><a href="#hint-“string”" class="headerlink" title="hint - “string”"></a>hint - “string”</h2><ul>
<li>  window.alert(obj)</li>
<li>  模板字符串<code>`$&#123;obj&#125;`</code></li>
<li>  作为属性键<code>test[obj]=123</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    [<span class="built_in">Symbol</span>.toPrimitive](hint) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hint == <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;hint is number&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (hint == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;hint is string&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// alert, 浏览器</span></span><br><span class="line"><span class="built_in">window</span>.alert(obj) <span class="comment">// hint is string</span></span><br><span class="line"><span class="comment">// $&#123;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;obj&#125;</span>`</span>) <span class="comment">// hint is string</span></span><br><span class="line"><span class="comment">// 属性键</span></span><br><span class="line">obj[obj] = <span class="number">123</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(obj)) <span class="comment">// hint is string</span></span><br></pre></td></tr></table></figure>

<h2 id="hint-“number”"><a href="#hint-“number”" class="headerlink" title="hint - “number”"></a>hint - “number”</h2><ul>
<li>  一元<code>+</code>，位移</li>
<li>  <code>-</code>, <code>*</code>, <code>/</code>, 关系运算符</li>
<li>  <code>Math.pow</code>, <code>String.prototype.slice</code>等很多内部方法</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    [<span class="built_in">Symbol</span>.toPrimitive](hint) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hint == <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">10</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (hint == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一元+</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;一元+:&#x27;</span>, +obj)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 位移运算符</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;位移运算符&#x27;</span>, obj &gt;&gt; <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//除减算法, 没有 + 法，之前已经单独说过转换规则</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;减法:&#x27;</span>, <span class="number">5</span> - obj)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;乘法:&#x27;</span>, <span class="number">5</span> * obj)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;除法:&#x27;</span>, <span class="number">5</span> / obj)</span><br><span class="line"></span><br><span class="line"><span class="comment">//逻辑 大于，小于，大于等于, 没有等于， 有自己的一套规则</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;大于:&#x27;</span>, <span class="number">5</span> &gt; obj)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;大于等于:&#x27;</span>, <span class="number">5</span> &gt;= obj)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他期望是整数的方法</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Math.pow:&#x27;</span>, <span class="built_in">Math</span>.pow(<span class="number">2</span>, obj))</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    一元+: 10</span></span><br><span class="line"><span class="comment">    位移运算符 10</span></span><br><span class="line"><span class="comment">    减法: -5</span></span><br><span class="line"><span class="comment">    乘法: 50</span></span><br><span class="line"><span class="comment">    除法: 0.5</span></span><br><span class="line"><span class="comment">    大于: false</span></span><br><span class="line"><span class="comment">    大于等于: false</span></span><br><span class="line"><span class="comment">    Math.pow: 1024</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="hint-“default”"><a href="#hint-“default”" class="headerlink" title="hint - “default”"></a>hint - “default”</h2><ul>
<li>  二元<code>+</code></li>
<li><code>==</code>, <code>!=</code><blockquote>
<p>二元与非严格逻辑判断 String +/==/!= Number</p>
</blockquote>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    [<span class="built_in">Symbol</span>.toPrimitive](hint) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hint == <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">10</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (hint == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// default</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;相加:&#x27;</span>, <span class="number">5</span> + obj) <span class="comment">// 6</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;等等与:&#x27;</span>, <span class="number">5</span> == obj) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;不等于:&#x27;</span>, <span class="number">5</span> != obj) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h1 id="误区"><a href="#误区" class="headerlink" title="误区"></a>误区</h1><ul>
<li>两个对象<code>===</code>, <code>!==</code> 是否触发隐式转换<blockquote>
<p>不会，两个对象比较的是引用</p>
</blockquote>
</li>
<li>两个对象<code>==</code>, <code>!=</code>是否触发隐式转换<blockquote>
<p><font color=red>不会</font><br>只有一个对象与非对象比较时才会触发隐式转换</p>
</blockquote>
</li>
</ul>
<h2 id="toString-与-valueOf"><a href="#toString-与-valueOf" class="headerlink" title="toString 与 valueOf"></a>toString 与 valueOf</h2><p>如果期望值是”string” —— 先调用<code>obj.toString()</code><br>如果期望值是”number” —— 先调用<code>obj.valueOf()</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">valueOf</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;user:&#x27;</span>, +user) <span class="comment">// 10 期望是数字</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;user:&#x27;</span>, <span class="string">`<span class="subst">$&#123;user&#125;</span>`</span>) <span class="comment">// John 期望是字符串</span></span><br></pre></td></tr></table></figure>

<h3 id="valueOf-不返回数字时"><a href="#valueOf-不返回数字时" class="headerlink" title="valueOf 不返回数字时"></a>valueOf 不返回数字时</h3><p>当<code>valueOf()</code>不再返回数字，继续调用<code>toString()</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// valueOf方法不存在时表现相同</span></span><br><span class="line">    <span class="function"><span class="title">valueOf</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// return this.age;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;user:&#x27;</span>, +user) <span class="comment">// user: NaN</span></span><br></pre></td></tr></table></figure>

<h3 id="toString-不返回字符串时"><a href="#toString-不返回字符串时" class="headerlink" title="toString 不返回字符串时"></a>toString 不返回字符串时</h3><ol>
<li>当对象存在 <code>toString()</code> 方法，但该方法不返回字符串时继续调用 <code>valueOf()</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// return this.name;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">valueOf</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;user:&#x27;</span>, <span class="string">`<span class="subst">$&#123;user&#125;</span>`</span>) <span class="comment">// user: 10</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>当对象不存在 <code>toString()</code> 方法时，执行 Object 原型上的 <code>Object.prototype.toString()</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">10</span>,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">valueOf</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;user:&#x27;</span>, <span class="string">`<span class="subst">$&#123;user&#125;</span>`</span>) <span class="comment">// [object Object]</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>当对象及其原型上都不存在 <code>toString()</code> 方法时，继续调用 <code>valueOf()</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">10</span>,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">valueOf</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Object</span>.prototype.toString = <span class="literal">undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;user:&#x27;</span>, <span class="string">`<span class="subst">$&#123;user&#125;</span>`</span>) <span class="comment">// user: 10</span></span><br></pre></td></tr></table></figure>

<h1 id="特殊的-Date"><a href="#特殊的-Date" class="headerlink" title="特殊的 Date"></a>特殊的 Date</h1><ul>
<li>  hint 是<font color=red>default</font>，是优先调用 toString，然后再调用 valueOf</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;date toString:&#x27;</span>, date.toString())</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;date valueOf:&#x27;</span>, date.valueOf())</span><br><span class="line"><span class="comment">// date toString: Sun May 08 2022 14:32:38 GMT+0800 (中国标准时间)</span></span><br><span class="line"><span class="comment">// date valueOf: 1651991558618</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`date number:`</span>, +date) <span class="comment">// 期望是数字</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`date str:`</span>, <span class="string">`<span class="subst">$&#123;date&#125;</span>`</span>) <span class="comment">// 期望是字符串</span></span><br><span class="line"><span class="comment">// date number: 1651991558618</span></span><br><span class="line"><span class="comment">// date str: Sun May 08 2022 14:32:38 GMT+0800 (中国标准时间)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`date +:`</span>, date + <span class="number">1</span>) <span class="comment">// 二元加法，hint 为 default</span></span><br><span class="line"><span class="comment">// date +: Sun May 08 2022 14:32:38 GMT+0800 (中国标准时间)1</span></span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul>
<li>  如果<code>[Symbol.toPrimitive](hint)</code>存在，优先调用，无视<code>valueOf</code>和<code>toString</code>方法</li>
<li>  否则，如果期望值是 <font color=red>“string”</font> —— 先调用<code>obj.toString()</code>如果返回<strong>不是原始值</strong>，继续调用<code>obj.valueOf()</code></li>
<li>  否则，如果期望值是<font color=red>“number”</font>或<font color=red>“default”</font> —— 先调用<code>obj.valueOf()</code>如果返回<strong>不是原始值</strong>，继续调用<code>obj.toString()</code></li>
</ul>
<table>
    <tr>
        <td>hint</td>
        <td>判断依据</td>
        <td>toPrimitive 不存在时</td>
    </tr>
    <tr>
        <td>String</td>
        <td><code>window.alert(obj)</code><br>模板字符串<code>`$&#123;obj&#125;`</code><br>作为属性键<code>test[obj]=123</code></td>
        <td>先调用<code>obj.toString()</code>如果返回不是原始值，继续调用<code>obj.valueOf()</code></td>
    </tr>
    <tr>
        <td>Number</td>
        <td>一元<code>+</code>，位移<br><code>-</code>, <code>*</code>, <code>/</code>, 关系运算符<br><code>Math.pow</code>, <code>String.prototype.slice</code>等很多内部方法</td>
        <td rowspan='2'>先调用<code>obj.valueOf()</code>如果返回不是原始值，继续调用<code>obj.toString()</code></td>
    </tr>
    <tr>
        <td>default</td>
        <td>二元<code>+</code><br><code>==</code>, <code>!=</code> 二元非严格逻辑判断</td>
    </tr>
</table>

<h1 id="最开始的例子"><a href="#最开始的例子" class="headerlink" title="最开始的例子"></a>最开始的例子</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">toString</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.value + <span class="number">10</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">valueOf</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj[obj] = obj.value</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;keys:&#x27;</span>, <span class="built_in">Object</span>.keys(obj))</span><br><span class="line"><span class="comment">// 作为属性键 hint-String</span></span><br><span class="line"><span class="comment">// keys: [ &#x27;20&#x27;, &#x27;value&#x27;, &#x27;toString&#x27;, &#x27;valueOf&#x27; ]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;$&#123;obj&#125;:&#x27;</span>, <span class="string">`<span class="subst">$&#123;obj&#125;</span>`</span>)</span><br><span class="line"><span class="comment">// 模板字符串 hint-String</span></span><br><span class="line"><span class="comment">// $&#123;obj&#125;: 20</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;obj + 1:&#x27;</span>, obj + <span class="number">1</span>)</span><br><span class="line"><span class="comment">// 二元加法 hint-Default valueOf已有返回值 (-&gt; toString)</span></span><br><span class="line"><span class="comment">// obj + 1: 11</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;obj + &quot;&quot;:&#x27;</span>, obj + <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">// 二元加法 hint-Default valueOf已有返回值 (-&gt; toString)</span></span><br><span class="line"><span class="comment">// obj + &quot;&quot;: 10</span></span><br></pre></td></tr></table></figure>

<h2 id="例子-1"><a href="#例子-1" class="headerlink" title="例子 1"></a>例子 1</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">4</span>, <span class="number">10</span>]</span><br><span class="line">arr[<span class="built_in">Symbol</span>.toPrimitive] = <span class="function"><span class="keyword">function</span> (<span class="params">hint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> hint</span><br><span class="line">&#125;</span><br><span class="line">arr.valueOf = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ arr + obj + arr + obj</span><br><span class="line">&quot;NaN[object Object]default[object Object]&quot;</span><br><span class="line">&#123;&#125; + arr</span><br><span class="line">NaN</span><br></pre></td></tr></table></figure>

<ol>
<li><code>+ arr</code>一元加法，hint 为 number（返回的 hint 是一个 string），因此<code>+ arr</code>等于<code>+&quot;number&quot;</code>，显然最终结果是<code>NaN</code>。</li>
<li>然后计算<code>NaN + obj</code>，hint 为 default，先调用 valueOf 然后调用 toString，相当于<code>&quot;NaN&quot; + &quot;[object Object]&quot;</code>,最终结果为<code>&quot;NaN[object Object]&quot;</code></li>
<li><code>&quot;NaN[object Object]&quot; + arr</code>，hint 为 default，由于<code>arr[Symbol.toPrimitive]</code>返回 hint，等于<code>&quot;NaN[object Object]&quot; + &quot;default&quot;</code></li>
<li><code>&quot;NaN[object Object]default&quot; + &#123;&#125;</code>显而易见，最终结果为<code>&quot;NaN[object Object]default[object Object]&quot;</code></li>
</ol>
<h2 id="例子-2"><a href="#例子-2" class="headerlink" title="例子 2"></a>例子 2</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> val = [] == ![]</span><br><span class="line"><span class="built_in">console</span>.log([+val, [] + <span class="number">1</span>] == [<span class="number">1</span>, <span class="number">1</span>] + [])</span><br><span class="line"><span class="built_in">console</span>.log([+val, [] + <span class="number">1</span>] == [<span class="number">1</span>, <span class="string">&#x27;1&#x27;</span>])</span><br></pre></td></tr></table></figure>

<ol>
<li><code>const val = [] == ![]</code>，将一个数组转换为布尔值，是真值，再对真值取反为<code>false</code>，<code>const val = [] == false</code></li>
<li>一个布尔值与其他值进行不严格等比较，两边转换为原始数据类型 Number，因此第一步转变为<code>const val = &quot;&quot; == 0</code>，最终转变为<code>const val = 0 == 0</code>，最后<code>val</code>被赋值为<code>true</code><blockquote>
<p>const val = true</p>
</blockquote>
</li>
</ol>
<ul>
<li>对于<code>[+val, [] + 1] == [1, 1] + []</code><ol>
<li><code>+val</code>一元加法，hint 为 number，真值 true 转为数字 1</li>
<li><code>[] + 1</code>二元加法，hint 为 default，先 valueOf 并没有返回原始值，再调用 toString 返回空字符串，最终等于<code>&quot;&quot;+1</code></li>
<li>左侧数组为<code>[1, &quot;1&quot;]</code><blockquote>
<p>[1, “1”] == [1, 1] + []</p>
</blockquote>
</li>
<li>右侧<code>[1, 1] + []</code>二元加法，hint 为 default，先 valueOf 然后 toString，最终等于<code>&quot;1,1&quot; + &quot;&quot;</code><blockquote>
<p>[1, “1”] == “1,1”</p>
</blockquote>
</li>
<li>最终表达式为<code>[1, &quot;1&quot;] == &quot;1,1&quot;</code>，<font color=red>一边为引用类型另一边为基础类型</font> ，需要隐式转换，hint 为 default，先 valueOf 然后 toString，表达式转换为<code>&quot;1,1&quot; == &quot;1,1&quot;</code></li>
<li>最终返回<code>true</code></li>
</ol>
</li>
<li>对于<code>[+val, [] + 1] == [1, &#39;1&#39;]</code><ol>
<li>同上，左侧数组为<code>[1, &quot;1&quot;]</code><blockquote>
<p><code>[1, &quot;1&quot;] == [1, &quot;1&quot;]</code></p>
</blockquote>
</li>
<li>请注意，<font color=red>这里两边均为引用类型，相当于<code>===</code>，两个引用类型时，比较的是引用</font>，因此返回<code>false</code></li>
</ol>
</li>
</ul>
<h2 id="例子-3"><a href="#例子-3" class="headerlink" title="例子 3"></a>例子 3</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> val = (+&#123;&#125; + [])[+[]]</span><br><span class="line"><span class="built_in">console</span>.log(val)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">N</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>(+&#123;&#125; + [])[+[]]</code></p>
</blockquote>
<ol>
<li> <code>+&#123;&#125; =&gt; NaN</code></li>
<li> <code>(NaN + [])[+[]]</code></li>
<li> [] 隐式转换 ‘’</li>
<li> <code>(NaN + &#39;&#39;)[+[]]</code></li>
<li> NaN + ‘’ =&gt; ‘NaN’</li>
<li> <code>(&#39;NaN&#39;)[+[]]</code></li>
<li> +[] =&gt; 0</li>
<li> <code>(&#39;NaN&#39;)[0]</code></li>
<li> ‘N’</li>
</ol>
<h2 id="例子-4"><a href="#例子-4" class="headerlink" title="例子 4"></a>例子 4</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;,</span><br><span class="line">    objA = &#123; <span class="attr">propertyA</span>: <span class="string">&#x27;A&#x27;</span> &#125;,</span><br><span class="line">    objB = &#123; <span class="attr">propertyB</span>: <span class="string">&#x27;B&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">obj[objA] = <span class="string">&#x27;objectA&#x27;</span></span><br><span class="line">obj[objB] = <span class="string">&#x27;ObjectB&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [k, v] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(obj)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;k:&#x27;</span>, k, <span class="string">&#x27;, v:&#x27;</span>, v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">k: [object Object] , v: ObjectB</span><br></pre></td></tr></table></figure>

<ul>
<li>  使用对象作为对象属性的键值，转换结果为字符串<code>[object Object]</code></li>
<li>  对象键的特性：本质上是字符串，如果是数字，用数字和数字字符串一致</li>
<li>  Object.entries：迭代器，能获取键值对数组</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;,</span><br><span class="line">    objA = &#123;</span><br><span class="line">        <span class="attr">propertyA</span>: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">        <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;objA&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    objB = &#123;</span><br><span class="line">        <span class="attr">propertyB</span>: <span class="string">&#x27;B&#x27;</span>,</span><br><span class="line">        <span class="function"><span class="title">valueOf</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;objB&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">obj[objA] = <span class="string">&#x27;objectA&#x27;</span></span><br><span class="line">obj[objB] = <span class="string">&#x27;ObjectB&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [p, v] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(obj)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;p:&#x27;</span>, p, <span class="string">&#x27;, v:&#x27;</span>, v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p: objA , v: objectA</span><br><span class="line">p: [object Object] , v: ObjectB</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/08/JavaScript%EF%BC%9A%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7%E9%81%8D%E5%8E%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/azem.png">
      <meta itemprop="name" content="Azem">
      <meta itemprop="description" content="记录些学习笔记，随便写写。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Azetus的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/08/JavaScript%EF%BC%9A%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7%E9%81%8D%E5%8E%86/" class="post-title-link" itemprop="url">JavaScript：对象的属性遍历</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-08 18:13:16" itemprop="dateCreated datePublished" datetime="2022-05-08T18:13:16+08:00">2022-05-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">JavaScript进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="属性的类型"><a href="#属性的类型" class="headerlink" title="属性的类型"></a>属性的类型</h1><ul>
<li>  普通属性</li>
<li>  不可枚举的属性</li>
<li>  原型属性</li>
<li>  Symbol 属性</li>
<li>  静态属性</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> symbolIsAnimal = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;pro_symbol_attr_isAnimal&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> symbolSay = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;pro_symbol_method_say&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> symbolSalary = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;ins_symbol_attr_salary&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">age, name</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.ins_in_attr_age = age</span><br><span class="line">    <span class="built_in">this</span>.ins_in_attr_name = name</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.ins_in_method_walk = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ins_method_walk&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型方法</span></span><br><span class="line">Person.prototype.pro_method_say = <span class="function"><span class="keyword">function</span> (<span class="params">words</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;pro_method_say:&#x27;</span>, words)</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype[symbolSay] = <span class="function"><span class="keyword">function</span> (<span class="params">words</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;pro_symbol_method_say&#x27;</span>, words)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型属性</span></span><br><span class="line">Person.prototype[symbolIsAnimal] = <span class="literal">true</span></span><br><span class="line">Person.prototype.pro_attr_isAnimal = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = <span class="keyword">new</span> Person(<span class="number">100</span>, <span class="string">&#x27;程序员&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Symbol 属性</span></span><br><span class="line">person[symbolSalary] = <span class="number">6000</span></span><br><span class="line">person[<span class="string">&#x27;ins_no_enumerable_attr_sex&#x27;</span>] = <span class="string">&#x27;男&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// sex 不可枚举</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">&#x27;ins_no_enumerable_attr_sex&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, symbolSalary, &#123;</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="comment">// 无效的设置</span></span><br><span class="line">    <span class="attr">value</span>: <span class="number">999</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><table>
<thead>
<tr>
<th>方法名</th>
<th>普通属性</th>
<th>不可枚举属性</th>
<th>Symbol 属性</th>
<th>原型属性</th>
</tr>
</thead>
<tbody><tr>
<td>for…in</td>
<td>√</td>
<td>×</td>
<td>×</td>
<td>√</td>
</tr>
<tr>
<td>Object.keys</td>
<td>√</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>Object.getOwnPropertyNames</td>
<td>√</td>
<td>√</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>Object.getOwnPropertySymbols</td>
<td>×</td>
<td>√</td>
<td>√</td>
<td>×</td>
</tr>
<tr>
<td>Reflect.ownKeys</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>×</td>
</tr>
</tbody></table>
<h1 id="1-获取对象的全部静态属性"><a href="#1-获取对象的全部静态属性" class="headerlink" title="1 获取对象的全部静态属性"></a>1 获取对象的全部静态属性</h1><ul>
<li>  不要被静态属性误导</li>
<li>  <code>Reflect.ownKeys</code> = <code>Object.getOwnPropertyNames</code> + <code>Object.getOwnPropertySymbols</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> keys = <span class="built_in">Object</span>.getOwnPropertyNames(_obj)</span><br><span class="line">keys = keys.concat(<span class="built_in">Object</span>.getOwnPropertySymbols(_obj))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> keys = <span class="built_in">Reflect</span>.ownKeys(_obj)</span><br></pre></td></tr></table></figure>

<h1 id="2-获得原型上的所有属性"><a href="#2-获得原型上的所有属性" class="headerlink" title="2 获得原型上的所有属性"></a>2 获得原型上的所有属性</h1><ul>
<li>  <code>for...in</code>? (拿不到不可枚举属性与 Symbol 属性)</li>
<li>  递归</li>
<li>  剔除内置属性</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grand</span> </span>&#123;</span><br><span class="line">    gName = <span class="string">&quot;Grand&quot;</span>;</span><br><span class="line">    <span class="function"><span class="title">gGetName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.gName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Grand.prototype[<span class="built_in">Symbol</span>.for(<span class="string">&quot;gAge&quot;</span>)] = <span class="string">&quot;G-12&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Grand</span> </span>&#123;</span><br><span class="line">    pName = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">    <span class="function"><span class="title">pGetName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.pName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Parent.prototype[<span class="built_in">Symbol</span>.for(<span class="string">&quot;pAge&quot;</span>)] = <span class="string">&quot;G-11&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    cName = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">    <span class="function"><span class="title">cGetName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.cName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = <span class="keyword">new</span> Child();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归</span></span><br><span class="line"><span class="keyword">let</span> result = [];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logAllProperties</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">let</span> proto = instance.__proto__;</span><br><span class="line">    <span class="keyword">while</span> (proto) &#123;</span><br><span class="line">        result.push(...Reflect.ownKeys(proto));</span><br><span class="line">        proto = proto.__proto__;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">logAllProperties(child);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;result==&quot;</span>, result);</span><br></pre></td></tr></table></figure>

<h1 id="3-获取所有不可枚举属性"><a href="#3-获取所有不可枚举属性" class="headerlink" title="3 获取所有不可枚举属性"></a>3 获取所有不可枚举属性</h1><ul>
<li>  如何知道某个属性不可枚举？</li>
<li>  考不考虑原型上的不可枚举属性？</li>
<li>  <code>getOwnPropertyDescriptor()</code> (会获得无关的描述符、开销大)</li>
<li>  <code>Object.prototype.propertyIsEnumerable.call()</code> (推荐)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getNoEnumerable</span>(<span class="params">_obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//获取原型对象</span></span><br><span class="line">    <span class="keyword">const</span> keys = <span class="built_in">Reflect</span>.ownKeys(_obj);</span><br><span class="line">    <span class="keyword">const</span> result = keys.filter(<span class="function"><span class="params">key</span>=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !<span class="built_in">Object</span>.getOwnPropertyDescriptor(_obj, key).enumerable</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getNoEnumerable</span>(<span class="params">_obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//获取原型对象</span></span><br><span class="line">    <span class="keyword">const</span> keys = <span class="built_in">Reflect</span>.ownKeys(_obj);</span><br><span class="line">    <span class="keyword">const</span> result = keys.filter(<span class="function"><span class="params">key</span>=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !<span class="built_in">Object</span>.prototype.propertyIsEnumerable.call(_obj, key)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="栗子"><a href="#栗子" class="headerlink" title="栗子"></a>栗子</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proto = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;p_parent&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;p_object&#x27;</span>,</span><br><span class="line">    [<span class="built_in">Symbol</span>.for(<span class="string">&#x27;p_address&#x27;</span>)]: <span class="string">&#x27;地球&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ins = <span class="built_in">Object</span>.create(proto)</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(ins, <span class="string">&#x27;age&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">18</span></span><br><span class="line">&#125;)</span><br><span class="line">ins.sex = <span class="number">1</span></span><br><span class="line">ins[<span class="built_in">Symbol</span>.for(<span class="string">&#x27;say&#x27;</span>)] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;say&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> inKeys = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> p <span class="keyword">in</span> ins) &#123;</span><br><span class="line">    inKeys.push(p)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(inKeys)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Reflect</span>.ownKeys(ins))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ &#x27;sex&#x27;, &#x27;name&#x27;, &#x27;type&#x27; ]</span><br><span class="line">[ &#x27;age&#x27;, &#x27;sex&#x27;, Symbol(say) ]</span><br></pre></td></tr></table></figure>

<ul>
<li>  <code>for..in</code>可以遍历出原型属性，但无法遍历不可枚举的属性与 Symbol 属性</li>
<li>  而<code>Reflect.ownKeys</code>无法遍历原型属性，但可以遍历不可枚举与 Symbol 属性</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/08/JavaScript%EF%BC%9A%E6%B7%B1%E5%85%A5%E5%AF%B9%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/azem.png">
      <meta itemprop="name" content="Azem">
      <meta itemprop="description" content="记录些学习笔记，随便写写。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Azetus的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/08/JavaScript%EF%BC%9A%E6%B7%B1%E5%85%A5%E5%AF%B9%E8%B1%A1/" class="post-title-link" itemprop="url">JavaScript：深入对象</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-08 17:47:12" itemprop="dateCreated datePublished" datetime="2022-05-08T17:47:12+08:00">2022-05-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">JavaScript进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-对象的普通属性、排序属性和隐藏类"><a href="#1-对象的普通属性、排序属性和隐藏类" class="headerlink" title="1 对象的普通属性、排序属性和隐藏类"></a>1 对象的普通属性、排序属性和隐藏类</h1><h2 id="属性遍历"><a href="#属性遍历" class="headerlink" title="属性遍历"></a>属性遍历</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">obj.p1 = <span class="string">&quot;str1&quot;</span>;</span><br><span class="line">obj.p6 = <span class="string">&quot;str6&quot;</span>;</span><br><span class="line">obj.p2 = <span class="string">&quot;str2&quot;</span>;</span><br><span class="line"></span><br><span class="line">obj[<span class="number">1</span>] = <span class="string">&#x27;num1&#x27;</span>;</span><br><span class="line">obj[<span class="number">6</span>] = <span class="string">&#x27;num6&#x27;</span>;</span><br><span class="line">obj[<span class="number">2</span>] = <span class="string">&#x27;num2&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;property:&quot;</span>, obj[p])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    property: num1</span></span><br><span class="line"><span class="comment">    property: num2</span></span><br><span class="line"><span class="comment">    property: num6</span></span><br><span class="line"><span class="comment">    property: str1</span></span><br><span class="line"><span class="comment">    property: str6</span></span><br><span class="line"><span class="comment">    property: str2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>我们能发现什么？</p>
<ul>
<li>  两种属性：字符串作为键和数字作为键的属性</li>
<li>  键被遍历的顺序似乎是有规律的</li>
</ul>
<h3 id="常规属性"><a href="#常规属性" class="headerlink" title="常规属性"></a>常规属性</h3><ul>
<li>  键位字符串的属性</li>
<li>  特点：<font color=red><strong>根据创建时的顺序排序</strong></font></li>
</ul>
<h3 id="排序属性"><a href="#排序属性" class="headerlink" title="排序属性"></a>排序属性</h3><ul>
<li>  属性键值为数字的属性</li>
<li>  特点： <font color=red><strong>按照索引值大小升序排序</strong></font></li>
</ul>
<h3 id="数字字符串属性是排序属性"><a href="#数字字符串属性是排序属性" class="headerlink" title="数字字符串属性是排序属性"></a>数字字符串属性是排序属性</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">obj[<span class="string">&#x27;1&#x27;</span>] = <span class="string">&#x27;p1&#x27;</span>;</span><br><span class="line">obj[<span class="string">&#x27;6&#x27;</span>] = <span class="string">&#x27;p6&#x27;</span>;</span><br><span class="line">obj[<span class="string">&#x27;2&#x27;</span>] = <span class="string">&#x27;p2&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;property:&quot;</span>, p)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    property: 1</span></span><br><span class="line"><span class="comment">    property: 2</span></span><br><span class="line"><span class="comment">    property: 6</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>可以类比字符串索引数组：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(arr[<span class="string">&quot;2&quot;</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(arr[<span class="string">&quot;3&quot;</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(arr[<span class="string">&quot;4&quot;</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="为何设计常规属性和排序属性"><a href="#为何设计常规属性和排序属性" class="headerlink" title="为何设计常规属性和排序属性"></a>为何设计常规属性和排序属性</h3><ul>
<li><p>  提升属性的访问速度</p>
</li>
<li><p>两种线性数据结构保存<br>  <img src="/2022/05/08/JavaScript%EF%BC%9A%E6%B7%B1%E5%85%A5%E5%AF%B9%E8%B1%A1/20220505203944.png" alt="20220505203944"></p>
</li>
<li><p>  elements -&gt; 排序属性</p>
</li>
<li><p>  properties -&gt; 常规属性</p>
</li>
</ul>
<p>V8 遍历对象时会先遍历<strong>排序属性</strong>，然后遍历<strong>常规属性</strong>。</p>
<h3 id="对象内属性"><a href="#对象内属性" class="headerlink" title="对象内属性"></a>对象内属性</h3><ul>
<li>  何为对象内属性：被保存到对象自身的<font color=red>常规属性</font></li>
<li>  内属性的数量（10 个左右）</li>
<li>  如何知道哪些属性时内属性？</li>
</ul>
<ol>
<li>优先将常规属性转变为内属性</li>
<li>当属性数量大于 10 时，将第 10 个之后的属性存入 properties，以下标顺序排序（线性数据结构）</li>
<li>当常规数量再增多时，存入 properties 的属性变为非线性结构（慢属性）</li>
</ol>
<h3 id="对象属性的存储"><a href="#对象属性的存储" class="headerlink" title="对象属性的存储"></a>对象属性的存储</h3><p>排序属性 elements 有可能会被转变非线性结构储存。（哈希表）<br>例：当排序只有 10 个时，对键为 10000 的属性进行赋值。</p>
<p><img src="/2022/05/08/JavaScript%EF%BC%9A%E6%B7%B1%E5%85%A5%E5%AF%B9%E8%B1%A1/20220505212434.png" alt="20220505212434"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foo[<span class="number">100000</span>] = <span class="string">`<span class="subst">$&#123;<span class="number">100000</span>&#125;</span>-<span class="subst">$&#123;<span class="built_in">Math</span>.random()&#125;</span>`</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/08/JavaScript%EF%BC%9A%E6%B7%B1%E5%85%A5%E5%AF%B9%E8%B1%A1/20220505212514.png" alt="20220505212514"></p>
<h2 id="隐藏类"><a href="#隐藏类" class="headerlink" title="隐藏类"></a>隐藏类</h2><ul>
<li>什么是隐藏类<ul>
<li>  描述了对象的属性布局</li>
<li>  属性名和对应的偏移量</li>
</ul>
</li>
<li>隐藏类的作用<ul>
<li>  从时间和空间两个维度提升速度</li>
</ul>
</li>
</ul>
<p>大多数的 Javascript 引擎会采用哈希表的方式来存取属性和寻找方法。而为了加快对象属性和方法在内存中的查找速度，V8 引擎引入了隐藏类(Hidden Class)的机制，起到给对象分组的作用。在初始化对象的时候，V8 引擎会创建一个隐藏类，随后在程序运行过程中每次增减属性，就会创建一个新的隐藏类或者查找之前已经创建好的隐藏类。每个隐藏类都会记录对应属性在内存中的偏移量，从而在后续再次调用的时候能更快地定位到其位置。</p>
<p><strong>动态添加和删除属性会导致隐藏类变动。</strong></p>
<h3 id="如何保护隐藏类"><a href="#如何保护隐藏类" class="headerlink" title="如何保护隐藏类"></a>如何保护隐藏类</h3><ul>
<li>  初始化时保持属性顺序一致</li>
<li>  一次性初始化完毕所有属性</li>
<li>  谨慎使用<code>delete</code></li>
</ul>
<h3 id="赋值-vs-delete-排序属性和普通属性"><a href="#赋值-vs-delete-排序属性和普通属性" class="headerlink" title="赋值 vs delete - 排序属性和普通属性"></a>赋值 vs delete - 排序属性和普通属性</h3><ul>
<li>100000 个对象，25 个普通属性。delete 还是赋值快？<ul>
<li>  赋值比 del 快一个数量级</li>
</ul>
</li>
<li>100000 个对象，25 个排序属性。delete 还是赋值快？<ul>
<li>  赋值比 del 快一倍左右</li>
</ul>
</li>
</ul>
<blockquote>
<p>这是因为排序属性的访问比普通属性快。 一个可以通过偏移量计算访问，一个要 hash 计算访问。而每一次 delete 操作都会改变隐藏类，导致性能下降。</p>
</blockquote>
<h3 id="对象字面量"><a href="#对象字面量" class="headerlink" title="对象字面量"></a>对象字面量</h3><ul>
<li>  是创建对象的一种快捷方式（object literal)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;myObject&#x27;</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  对应的还有：函数字面量、数组字面量等</li>
<li><strong>字面量的性能优于使用 new 构建</strong><blockquote>
<p>隐藏类：字面量创建对象会一次性构建隐藏类，而<code>new Object</code>创建时，需要通过<code>this.a = xxx; this.b = yyy</code>的形式创建，而每一次的动态赋值都会导致隐藏类变动。</p>
</blockquote>
</li>
</ul>
<hr>
<h1 id="2-属性来源，属性访问控制，属性冻结"><a href="#2-属性来源，属性访问控制，属性冻结" class="headerlink" title="2 属性来源，属性访问控制，属性冻结"></a>2 属性来源，属性访问控制，属性冻结</h1><h2 id="属性来源"><a href="#属性来源" class="headerlink" title="属性来源"></a>属性来源</h2><ul>
<li>  静态属性，例如：<code>Object.assign()</code> （不需要实例化即可使用）</li>
<li>  原型属性，例如：<code>Object.prototype.toString()</code> （来自于原型链，不来自实例本身）</li>
<li>  实例属性，例如：<code>function Person (name)&#123; this.name = name &#125;</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 原型属性</span></span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">    <span class="built_in">this</span>.age = age</span><br><span class="line">    <span class="built_in">this</span>.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实例属性</span></span><br><span class="line">Person.prototype.getAge = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person()</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name, age</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name</span><br><span class="line">        <span class="built_in">this</span>.age = age</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 实例属性</span></span><br><span class="line">    getName = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 原型属性</span></span><br><span class="line">    <span class="function"><span class="title">getAge</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> hasOwn = <span class="built_in">Object</span>.hasOwnProperty</span><br><span class="line"><span class="keyword">const</span> print = <span class="built_in">console</span>.log</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person()</span><br><span class="line">print(<span class="string">&#x27;getName:&#x27;</span>, hasOwn.call(person, <span class="string">&#x27;getName&#x27;</span>)) <span class="comment">// true</span></span><br><span class="line">print(<span class="string">&#x27;getAge:&#x27;</span>, hasOwn.call(person, <span class="string">&#x27;getAge&#x27;</span>)) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h2 id="属性描述符"><a href="#属性描述符" class="headerlink" title="属性描述符"></a>属性描述符</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&#x27;Azetus&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> des = <span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;name:&#x27;</span>, des)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    name: &#123;</span></span><br><span class="line"><span class="comment">    value: &#x27;Azetus&#x27;,</span></span><br><span class="line"><span class="comment">    writable: false,</span></span><br><span class="line"><span class="comment">    enumerable: false,</span></span><br><span class="line"><span class="comment">    configurable: false</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>设置属性 <code>Object.defineProperty</code> <code>Object.defineProperties</code></p>
<p>读取属性描述符 <code>Object.getOwnPropertyDescriptor</code> <code>Object.getOwnPropertyDescriptors</code></p>
<ul>
<li><p>  configurable：可配置（是否可以删除，属性描述是否可以更改）</p>
</li>
<li><p>  enumerable：是否可枚举（是否会出现在 for…in）</p>
</li>
<li><p>  value：值</p>
</li>
<li><p>  writable：是否可以被更改</p>
</li>
<li><p>get, set：访问器函数</p>
<blockquote>
<p>大体可以分为两种：</p>
</blockquote>
</li>
<li><p>  数据属性：value, writable, configurable, enumerable</p>
</li>
<li><p>  访问器属性：get, set, configurable, enumerable</p>
</li>
</ul>
<h3 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h3><p>先看一下代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&#x27;name&#x27;</span>, &#123;&#125;)</span><br><span class="line"></span><br><span class="line">obj.name = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.name) <span class="comment">// undefind</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, <span class="string">&#x27;name&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><code>Object.defineProperty</code> 第三个参数传入空对象时，其默认值为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假如我们尝试修改描述符</p>
<h4 id="case-01"><a href="#case-01" class="headerlink" title="case 01"></a>case 01</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 尝试修改描述符信息</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取信息</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, <span class="string">&#x27;name&#x27;</span>))</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">    value: undefined,</span></span><br><span class="line"><span class="comment">    writable: false,</span></span><br><span class="line"><span class="comment">    enumerable: false,</span></span><br><span class="line"><span class="comment">    configurable: false</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>可以看到，在 configurable 为 false 时，我们成功的将 name 属性的 writable 从 true 修改成了 false。</p>
<blockquote>
<p>根据 tc39 ecma262 的文档对 configurable 的描述：<br>If false, attempts to delete the property, change it from a data property to an accessor property or from an accessor property to a data property, or make any changes to its attributes <font color=red>(other than replacing an existing [[Value]] or setting [[Writable]] to false)</font> will fail.</p>
</blockquote>
<p>如果为 false，尝试删除属性、将数据属性变为访问器属性或反之、以及对该属性描述符做任何更改将会报错。<font color=red>(除了变更属性的 value 或将 Writable 改为 false 之外)</font></p>
<p>如果一个描述符不具有 value, writable, get 和 set 中的任意一个键，那么它将被认为是一个数据描述符。如果一个描述符同时拥有 value 或 writable 和 get 或 set 键，则会产生一个异常。</p>
<h4 id="case-02"><a href="#case-02" class="headerlink" title="case 02"></a>case 02</h4><p>以下代码会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 尝试修改描述符信息</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 会报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取信息</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, <span class="string">&#x27;name&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Object-defineProperty-的缺点"><a href="#Object-defineProperty-的缺点" class="headerlink" title="Object.defineProperty 的缺点"></a>Object.defineProperty 的缺点</h3><ul>
<li>  无法监听数组变化</li>
<li>  只能劫持对象的属性，如果属性也是一个对象，需要进行递归操作</li>
</ul>
<h3 id="对象的可扩展-Object-preventExtensions"><a href="#对象的可扩展-Object-preventExtensions" class="headerlink" title="对象的可扩展 - Object.preventExtensions"></a>对象的可扩展 - Object.preventExtensions</h3><ul>
<li>  Object.preventExtensions：对象变得不可扩展，也就是永远不能再添加新的属性</li>
<li>  Object.isExtensible：判断一个对象是否可以扩展</li>
</ul>
<h3 id="对象的封闭-Object-seal"><a href="#对象的封闭-Object-seal" class="headerlink" title="对象的封闭 - Object.seal"></a>对象的封闭 - Object.seal</h3><ul>
<li>  Object.seal：阻止添加新的属性 + <font color=red>属性标记为不可配置</font></li>
<li>  Object.isSealed：判断一个对象是否被封闭</li>
</ul>
<h3 id="对象的冻结-Object-freeze"><a href="#对象的冻结-Object-freeze" class="headerlink" title="对象的冻结 - Object.freeze"></a>对象的冻结 - Object.freeze</h3><ul>
<li>  Object.freeze：不能添加新属性 + 不可配置 + 不能修改值</li>
<li>  Object.isFrozen：判断一个对象是否被冻结</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><table>
<thead>
<tr>
<th>方法</th>
<th>新增属性</th>
<th>修改描述符</th>
<th>删除属性</th>
<th>更改属性值</th>
</tr>
</thead>
<tbody><tr>
<td>Object.preventExtensions</td>
<td>不可</td>
<td>可</td>
<td>可</td>
<td>可</td>
</tr>
<tr>
<td>Object.seal</td>
<td>不可</td>
<td>不可(writable 有例外)</td>
<td>不可</td>
<td>可</td>
</tr>
<tr>
<td>Object.freeze</td>
<td>不可</td>
<td>不可(writable 有例外)</td>
<td>不可</td>
<td>不可</td>
</tr>
</tbody></table>
<hr>
<h1 id="3-访问对象的原型"><a href="#3-访问对象的原型" class="headerlink" title="3 访问对象的原型"></a>3 访问对象的原型</h1><h2 id="1-prototype"><a href="#1-prototype" class="headerlink" title="1. prototype"></a>1. prototype</h2><ul>
<li>  prototype 是一个对象</li>
<li>  原型会形成原型链，原型链上查找属性比较耗时，访问不存在的属性会访问整个原型链</li>
</ul>
<h3 id="两个问题"><a href="#两个问题" class="headerlink" title="两个问题"></a>两个问题</h3><ul>
<li>  class 的 ES5 实现？</li>
</ul>
<p><img src="/2022/05/08/JavaScript%EF%BC%9A%E6%B7%B1%E5%85%A5%E5%AF%B9%E8%B1%A1/3-3-1.png" alt="img01"></p>
<ul>
<li>  toString 的怪异现象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> proto = <span class="built_in">Boolean</span>.prototype</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> proto)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(proto))</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    object</span></span><br><span class="line"><span class="comment">    [object Boolean]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Else if O has a [[BooleanData]] internal slot, let builtinTag be “Boolean”.</p>
</blockquote>
<h2 id="2-proto"><a href="#2-proto" class="headerlink" title="2. __proto__"></a>2. __proto__</h2><ul>
<li>  构造函数的原型</li>
<li>  null 以外的对象均有__proto__属性</li>
<li>  Function，class 的实例有 prototype 以及__proto__属性</li>
<li>  <strong>普通函数祖上三代必为 null</strong></li>
</ul>
<h3 id="两个问题-1"><a href="#两个问题-1" class="headerlink" title="两个问题"></a>两个问题</h3><ul>
<li>__proto__是实例对象的自身属性还是原型上的属性？<ul>
<li>  <strong>原型上的</strong></li>
</ul>
</li>
<li>普通对象祖上第几代__proto__为 null<ul>
<li>  <strong>两代</strong></li>
</ul>
</li>
</ul>
<h2 id="3-instanceof"><a href="#3-instanceof" class="headerlink" title="3. instanceof"></a>3. instanceof</h2><ul>
<li>  检测构造函数的 prototype 属性是否出现在某个实例对象的原型链上</li>
<li>  手写 instanceof</li>
<li>  <code>Object instanceof Function</code>, <code>Function instanceof Object</code></li>
</ul>
<h3 id="手写一个简单的-instanceof"><a href="#手写一个简单的-instanceof" class="headerlink" title="手写一个简单的 instanceof"></a>手写一个简单的 instanceof</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">instanceOf</span>(<span class="params">instance, cclass</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> proto = instance.__proto__</span><br><span class="line">    <span class="keyword">let</span> prototype = cclass.prototype</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (proto) &#123;</span><br><span class="line">        <span class="keyword">if</span> (proto === prototype) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        proto = proto.__proto__</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CChild</span> <span class="keyword">extends</span> <span class="title">Child</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Luren</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> cchild = <span class="keyword">new</span> CChild()</span><br></pre></td></tr></table></figure>

<h3 id="Object-instanceof-Function-Function-instanceof-Object"><a href="#Object-instanceof-Function-Function-instanceof-Object" class="headerlink" title="Object instanceof Function, Function instanceof Object"></a><code>Object instanceof Function</code>, <code>Function instanceof Object</code></h3><p>二者均为 True</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getType = <span class="function">(<span class="params">val</span>) =&gt;</span> <span class="built_in">Object</span>.prototype.toString.call(val)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPrototypeChains</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> chains = []</span><br><span class="line">    <span class="keyword">let</span> proto = instance.__proto__</span><br><span class="line">    chains.push(getType(proto))</span><br><span class="line">    <span class="keyword">while</span> (proto) &#123;</span><br><span class="line">        proto = proto.__proto__</span><br><span class="line">        chains.push(getType(proto))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> chains</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> print = <span class="built_in">console</span>.log</span><br><span class="line">print(getPrototypeChains(<span class="built_in">Function</span>))</span><br><span class="line">print(getPrototypeChains(<span class="built_in">Object</span>))</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    [ &#x27;[object Function]&#x27;, &#x27;[object Object]&#x27;, &#x27;[object Null]&#x27; ]</span></span><br><span class="line"><span class="comment">    [ &#x27;[object Function]&#x27;, &#x27;[object Object]&#x27;, &#x27;[object Null]&#x27; ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="4-getPrototypeOf"><a href="#4-getPrototypeOf" class="headerlink" title="4. getPrototypeOf"></a>4. getPrototypeOf</h2><ul>
<li>  返回对象的原型</li>
<li>  <code>Object.getPrototypeOf</code>, <code>Reflect.getPrototypeOf</code></li>
<li>  内部先 toObject 转换，注意 null 和 undefined</li>
</ul>
<h2 id="5-setPrototypeOf"><a href="#5-setPrototypeOf" class="headerlink" title="5. setPrototypeOf"></a>5. setPrototypeOf</h2><ul>
<li>  指定对象的原型</li>
<li>  <code>Object.setPrototypeOf</code>, <code>Reflect.setPrototypeOf</code></li>
<li>  原型的尽头是 null</li>
</ul>
<h2 id="6-isPrototypeOf"><a href="#6-isPrototypeOf" class="headerlink" title="6. isPrototypeOf"></a>6. isPrototypeOf</h2><ul>
<li>  一个对象是否存在于另一个对象的原型链上</li>
<li>  <code>Object.isPrototypeOf</code>, <code>Object.prototype.isPrototypeOf</code>, <code>Function.isPrototypeOf</code>, <code>Reflect.isPrototypeOf</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.isPrototypeOf(&#123;&#125;) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.isPrototypeOf(&#123;&#125;) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Reflect</span>.isPrototypeOf(&#123;&#125;) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Function</span>.isPrototypeOf(&#123;&#125;) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li>  <code>Object.create</code></li>
</ul>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p><img src="/2022/05/08/JavaScript%EF%BC%9A%E6%B7%B1%E5%85%A5%E5%AF%B9%E8%B1%A1/3-3-2.png" alt="img02"></p>
<h1 id="栗子"><a href="#栗子" class="headerlink" title="栗子"></a>栗子</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123; <span class="attr">n</span>: <span class="number">1</span> &#125;</span><br><span class="line">a.x = a = &#123; <span class="attr">n</span>: <span class="number">2</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 求a.x</span></span><br><span class="line"><span class="built_in">console</span>.log(a.x)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">undefined</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123; <span class="attr">n</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">let</span> b = a</span><br><span class="line">a.x = a = &#123; <span class="attr">n</span>: <span class="number">2</span> &#125;</span><br><span class="line"><span class="built_in">console</span>.log(a.x)</span><br><span class="line"><span class="built_in">console</span>.log(b)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">undefined</span><br><span class="line">&#123; n: 1, x: &#123; n: 2 &#125; &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  JavaScript 连续赋值时从右向左执行</li>
<li>  <code>.</code>的优先级比<code>=</code>高</li>
<li>  对象属于引用类型</li>
</ul>
<p>对于<code>a.x = a = &#123; n: 2 &#125;</code></p>
<ol>
<li>先执行<code>a.x</code>，为堆内存中的对象新增了一个属性，键为 x 值为 undefined，此时<code>a.x</code>的部分指向堆内存中的对象<code>&#123;n:1, x: undefined&#125;</code>的属性 <code>x</code></li>
<li>连续赋值从右向左执行，<code>a = &#123; n: 2 &#125;</code>，a 指向的对象变为了堆内存中的<code>&#123; n: 2 &#125;</code></li>
<li>继续向左执行，将此时 a 指向的对象<code>&#123; n: 2 &#125;</code>，赋值给对象<code>&#123;n:1, x: undefined&#125;</code>的属性 <code>x</code>，对象变为<code>&#123; n: 1, x: &#123; n: 2 &#125; &#125;</code></li>
<li>赋值完毕，此时 a 指向 <code>&#123; n: 2 &#125;</code>，并没有属性 x，打印显示 undefined</li>
<li>b 指向的对象从始至终没有改变，<code>&#123; n: 1, x: &#123; n: 2 &#125; &#125;</code></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/08/JavaScript%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%BB%86%E8%8A%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/azem.png">
      <meta itemprop="name" content="Azem">
      <meta itemprop="description" content="记录些学习笔记，随便写写。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Azetus的随笔">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/08/JavaScript%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%BB%86%E8%8A%82/" class="post-title-link" itemprop="url">JavaScript：数据类型细节</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-08 12:55:28" itemprop="dateCreated datePublished" datetime="2022-05-08T12:55:28+08:00">2022-05-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">JavaScript进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-数据类型的陷阱"><a href="#1-数据类型的陷阱" class="headerlink" title="1 数据类型的陷阱"></a>1 数据类型的陷阱</h1><h2 id="判断是不是-Object"><a href="#判断是不是-Object" class="headerlink" title="判断是不是 Object"></a>判断是不是 Object</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> obj === <span class="string">&#x27;object&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>第一个问题：上面的方法有什么问题？</p>
<blockquote>
<p><code>typeof null</code> 返回的值也是<code>object</code></p>
</blockquote>
</li>
<li><p>  第二个问题：为什么<code>typeof null</code> 返回的值是<code>object</code></p>
</li>
</ul>
<p>让我们追溯到 JavaScript 的第一个版本，此时一个值在栈中占用<strong>32 个位的存储单元</strong>，而其分为两个部分，第一部分为<strong>3 位的标记位</strong>剩余的位存储数据。此时 JavaScript 只有 5 种数据类型。</p>
<blockquote>
<p>000: object<br>001: interger<br>010: double<br>100: string<br>110: boolean</p>
</blockquote>
<p>而 null 是特殊的一类，其 32 位机器码全部为 0，所以，其标记位也自然全部为 0。</p>
<ul>
<li>  第三个问题：为什么不修复这个问题？</li>
</ul>
<p>问题存在的位置过于底层，牵一发而动全身。</p>
<h2 id="一元运算符-转为数字"><a href="#一元运算符-转为数字" class="headerlink" title="一元运算符+转为数字"></a>一元运算符+转为数字</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toNumber</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> +val</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ES5 中没有问题，但是在 ES6 中会报错，因为 ES6 引入了<code>BigInt</code>与<code>Symbol</code>数据类型，二者无法被转变为<code>number</code>。</p>
<h2 id="位转移为数字"><a href="#位转移为数字" class="headerlink" title="位转移为数字"></a>位转移为数字</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toNumber</span>(<span class="params">val</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val &gt;&gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toNumber2</span>(<span class="params">val</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val &gt;&gt;&gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个代码会有什么问题？当输入一个非常大的数的时候会返回什么？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 超大的数</span></span><br><span class="line">toNumber(<span class="built_in">Number</span>.MAX_SAFE_INTEGER)   <span class="comment">// -1</span></span><br><span class="line">toNumber2(<span class="built_in">Number</span>.MAX_SAFE_INTEGER)  <span class="comment">// 4294967295</span></span><br></pre></td></tr></table></figure>

<p>为什么会这样？</p>
<h3 id="无符号位移的情况"><a href="#无符号位移的情况" class="headerlink" title="无符号位移的情况"></a>无符号位移的情况</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// toNumber2(Number.MAX_SAFE_INTEGER)  =&gt; 4294967295</span></span><br><span class="line"><span class="keyword">var</span> val = <span class="built_in">Number</span>.MAX_SAFE_INTEGER.toString(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// 11111111111111111111111111111111111111111111111111111</span></span><br><span class="line"><span class="keyword">var</span> val1 = val.substring(<span class="number">0</span>,<span class="number">32</span>)</span><br><span class="line"><span class="comment">// 11111111111111111111111111111111</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="built_in">parseInt</span>(val1, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// 4294967295</span></span><br></pre></td></tr></table></figure>

<p>当进行右移位运算的时候，会将数字当做一个 <strong>32 位</strong>整数进行计算的，当长度超出 <strong>32 位时</strong>会进行截取。</p>
<h3 id="有符号位移的情况"><a href="#有符号位移的情况" class="headerlink" title="有符号位移的情况"></a>有符号位移的情况</h3><blockquote>
<p>有符号数字，最高位为符号位。</p>
</blockquote>
<p>十进制变二进制：原码 -&gt; 反码 -&gt; 加一（补码）<br>二进制变十进制：减一 -&gt; 反码 -&gt; 原码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> val = <span class="built_in">Number</span>.MAX_SAFE_INTEGER.toString(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// 11111111111111111111111111111111111111111111111111111</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> val1 = val.substring(<span class="number">0</span>,<span class="number">32</span>)</span><br><span class="line"><span class="comment">// 11111111111111111111111111111111</span></span><br></pre></td></tr></table></figure>

<p>截取前 32 位后减一</p>
<p><code>11111111111111111111111111111110</code></p>
<p>之后再取反码</p>
<p><code>00000000000000000000000000000001 = 1</code></p>
<p>最终等于 1，因为其最高位 1 是负数。</p>
<blockquote>
<p>此外这种方法对于 BigInt 和 Symbol 也是无效的！</p>
</blockquote>
<h3 id="补充知识，关于-JavaScript-的补码"><a href="#补充知识，关于-JavaScript-的补码" class="headerlink" title="补充知识，关于 JavaScript 的补码"></a>补充知识，关于 JavaScript 的补码</h3><p>JavaScript 将数字存储为 64 位浮点数，但所有按位运算都以 32 位二进制数执行。在执行位运算之前，JavaScript 将数字转换为 32 位有符号整数。执行按位操作后，结果将转换回 64 位 JavaScript 数。</p>
<p>对于有符号的整数，JavaScript 为了方便底层识别和运算，二进制使用补码。正数的补码就是原码本身，而负数的反码为其原码除符号位以外的各位按位取反，并在末位加一。</p>
<blockquote>
<p>正数：补码 = 原码；<br>负数：补码 = 除符号位取反码+1;</p>
</blockquote>
<p>以按位取反 <code>~</code> 运算符为例：</p>
<p><code>~5 -&gt; -6</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">00000000000000000000000000000101 (5)</span><br><span class="line">11111111111111111111111111111010 (~5 = -6)</span><br><span class="line">11111111111111111111111111111011 (-5 即 ~5+1)</span><br></pre></td></tr></table></figure>

<p>有符号整数使用最左边的位作为减号。</p>
<p>所以：<br><code>~x</code> -&gt; <code>-(x+1)</code></p>
<p>例子：<br>57 的二进制表示为(1 个字节):00111001<br>按位取反后(<del>57)的二进制: 11000110 此表示为十进制:-70<br>这是一个负数，是有符号的数，负数在计算机里要用其补码来表示:补码=符号位以后按位取反再加 1<br>所以-70(11000110)符号位以后按位取反后为(10111001) 再加 1 则为(10111010)<br>换成十进制为:-58<br>因此</del>57=-58</p>
<p>总结：当进行别的运算的时候，也需要将所有原码转换成补码，正数的原码=补码，负数的补码为反码+1，反码为原码除符号位取反，之后进行相应运算，（&amp;、|、~、^、移动等），然后反向求原码，可以得到最后结果。</p>
<blockquote>
<p>按位取反小窍门：</p>
</blockquote>
<p><code>!~x</code> -&gt; <code>-1</code> 返回 <code>true</code> 其他均为 <code>false</code><br><code>!!~x</code> -&gt; <code>-1</code> 返回 <code>false</code> 而其他均为 <code>true</code></p>
<p>可以判断后端 api 返回的 errno 是否为-1</p>
<h2 id="字符串批量转换为整数"><a href="#字符串批量转换为整数" class="headerlink" title="字符串批量转换为整数"></a>字符串批量转换为整数</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>];</span><br><span class="line">arr.map(<span class="built_in">parseInt</span>)</span><br></pre></td></tr></table></figure>

<p>结果是什么？</p>
<p><code>[ 1, NaN, NaN ]</code></p>
<p>为什么？</p>
<p>其实上面的代码相当于</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>].map(<span class="function">(<span class="params">val, index</span>) =&gt;</span> <span class="built_in">parseInt</span>(val, index))</span><br></pre></td></tr></table></figure>

<p><code>parseInt</code>的第二个参数是进制。取值范围<code>2 ~ 36</code></p>
<h2 id="if-条件判断"><a href="#if-条件判断" class="headerlink" title="if 条件判断"></a>if 条件判断</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = &#123;&#125;;</span><br><span class="line"><span class="comment">// name存在</span></span><br><span class="line"><span class="keyword">if</span>(obj.name)&#123;</span><br><span class="line">    result.name = obj.name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br></pre></td></tr></table></figure>

<p>本质是转为布尔值。<br>falsy : <code>0</code> , <code>false</code>, <code>&quot;&quot;</code>, <code>null</code>, <code>undefined</code>, <code>NaN</code></p>
<p>也会被转为 <code>false</code></p>
<p>应该使用<code>Object.hasOwnProperty()</code></p>
<h2 id="宽松比较"><a href="#宽松比较" class="headerlink" title="宽松比较"></a>宽松比较</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="literal">null</span> == <span class="number">0</span>) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;0&#x27;</span> == <span class="literal">false</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>本质：隐式转换</p>
<ul>
<li>  NaN 和任何值都不等，包括它自己</li>
<li>  bigInt，Symbol 首先比较是否同类型</li>
<li>  null，undefined</li>
<li>  布尔值与其他类型（布尔值 -&gt; 数字）</li>
<li>  数字类型和字符串类型（字符串 -&gt; 数字）</li>
<li>对象类型和原始类型相比较（对象类型 -&gt; 原始类型）<ul>
<li>  对象类型与对象类型（比较引用）</li>
</ul>
</li>
</ul>
<h2 id="杂谈"><a href="#杂谈" class="headerlink" title="杂谈"></a>杂谈</h2><ul>
<li>  <code>typeof</code>性能比<code>instanceof</code>性能高 2 倍 （百万级别）</li>
<li>null 和 undefined 实现机制完全不一样<ul>
<li>  null 是一个关键字，而 undefined 是一个变量</li>
</ul>
</li>
<li>  判断是不是数字，NaN</li>
</ul>
<hr>
<h1 id="2-数据类型的-8-种判断方式"><a href="#2-数据类型的-8-种判断方式" class="headerlink" title="2 数据类型的 8 种判断方式"></a>2 数据类型的 8 种判断方式</h1><h2 id="第一种：typeof"><a href="#第一种：typeof" class="headerlink" title="第一种：typeof"></a>第一种：typeof</h2><ul>
<li>  主要用途：操作数的类型，只能识别基础数据类型和引用类型</li>
<li><strong>特别注意</strong>：null，NaN，document.all<ul>
<li>  null -&gt; Object</li>
<li>  NaN -&gt; Number</li>
<li>  document.all -&gt; undefind</li>
</ul>
</li>
<li>  注意事项：已经不是绝对安全（暂时性死区）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">typeof</span> a</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line">log()<span class="comment">// Cannot access &#x27;a&#x27; before initialization</span></span><br></pre></td></tr></table></figure>

<h2 id="第二种：constructor"><a href="#第二种：constructor" class="headerlink" title="第二种：constructor"></a>第二种：constructor</h2><ul>
<li>  原理：constructor 指向创建实例对象的构造函数（然后 toString）</li>
<li>注意事项：<ul>
<li>  null 和 undefined 没有构造函数</li>
<li>  constructor 可以被改写</li>
</ul>
</li>
<li>  并不安全</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.prototype.constructor = <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>.constructor)</span><br></pre></td></tr></table></figure>

<p>可以被改写，因此十分不安全，只能作为辅助手段。</p>
<h2 id="第三种：instanceof"><a href="#第三种：instanceof" class="headerlink" title="第三种：instanceof"></a>第三种：instanceof</h2><ul>
<li>  原理：在原型链上查找，查到即是其示例</li>
<li>注意事项：<ul>
<li>  右操作数必须是函数或者 class</li>
<li>  <strong>多全局对象，例如多 window 之间</strong>，此对象非彼对象</li>
<li>  例：iframe</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> frame = <span class="built_in">window</span>.frames[<span class="number">0</span>]</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> isInstanceOf = [] <span class="keyword">instanceof</span> frame.Array</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&#x27;frame.Array&#x27;</span>, frame.Array)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&#x27;isInstanceOf&#x27;</span>, isInstanceOf)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="第四种：isPrototypeOf"><a href="#第四种：isPrototypeOf" class="headerlink" title="第四种：isPrototypeOf"></a>第四种：isPrototypeOf</h2><ul>
<li>  原理：是否出现在实例对象的原型链上</li>
<li>注意事项：<ul>
<li>  能正常返回值的情况，基本等同于 instanceof</li>
</ul>
</li>
</ul>
<h2 id="第五种：Object-prototype-toString"><a href="#第五种：Object-prototype-toString" class="headerlink" title="第五种：Object.prototype.toString"></a>第五种：Object.prototype.toString</h2><ul>
<li>  原理：通过函数的动态 this 特效，返回其数据类型</li>
<li>自定义对象如何获得<code>[object MyArray]</code>类型<ul>
<li>  Symbol.toStringTag</li>
</ul>
</li>
<li><code>Object.prototype.toString.call(Boolean.prototype)</code>会返回什么<ul>
<li>  Object</li>
</ul>
</li>
</ul>
<h2 id="第六种：鸭子类型检查"><a href="#第六种：鸭子类型检查" class="headerlink" title="第六种：鸭子类型检查"></a>第六种：鸭子类型检查</h2><ul>
<li>  原理：检查自身，属性的类型或者执行结果的类型</li>
<li>  例子：kindOf 与 p-is-promise</li>
<li>  适用场景：候选方案</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPromise</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value <span class="keyword">instanceof</span> <span class="built_in">Promise</span> || (</span><br><span class="line">        isObject(value) &amp;&amp;</span><br><span class="line">        <span class="keyword">typeof</span> value.then === <span class="string">&#x27;function&#x27;</span> &amp;&amp;</span><br><span class="line">        <span class="keyword">typeof</span> value.catch === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第七种：Symbol-toStringTag"><a href="#第七种：Symbol-toStringTag" class="headerlink" title="第七种：Symbol.toStringTag"></a>第七种：Symbol.toStringTag</h2><ul>
<li>  原理：Object.prototype.toString 会读取该值</li>
<li>  适用场景：需自定义类型</li>
<li>注意事项：<ul>
<li>  兼容性</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyArray</span> </span>&#123;</span><br><span class="line">    get [<span class="built_in">Symbol</span>.toStringTag]()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;MyArray&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pf = <span class="built_in">console</span>.log;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> MyArray();</span><br><span class="line">pf(<span class="built_in">Object</span>.prototype.toString.call(a) )</span><br></pre></td></tr></table></figure>

<h2 id="第八种：等比较"><a href="#第八种：等比较" class="headerlink" title="第八种：等比较"></a>第八种：等比较</h2><ul>
<li>  原理：与某个固定值比较</li>
<li>  适用场景：undefind、window、document、null</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// underscore源码</span></span><br><span class="line">_.isUndefined = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj === <span class="keyword">void</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><table>
<thead>
<tr>
<th>方法</th>
<th>基础数据类型</th>
<th>引用类型</th>
<th>注意事项</th>
</tr>
</thead>
<tbody><tr>
<td>typeof</td>
<td>√</td>
<td>×</td>
<td>NaN, Object, document.all</td>
</tr>
<tr>
<td>constructor</td>
<td>部分</td>
<td>√</td>
<td>可以被改写</td>
</tr>
<tr>
<td>instanceof</td>
<td>×</td>
<td>√</td>
<td>多窗口，右边必须是构造函数或者 class</td>
</tr>
<tr>
<td>isPrototypeOf</td>
<td>×</td>
<td>√</td>
<td>小心 null 和 undefined</td>
</tr>
<tr>
<td>toString</td>
<td>√</td>
<td>√</td>
<td>小心内置原型</td>
</tr>
<tr>
<td>鸭子类型</td>
<td>–</td>
<td>√</td>
<td>不得已或者兼容时</td>
</tr>
<tr>
<td>Symbol.toStringTag</td>
<td>×</td>
<td>√</td>
<td>用于识别自定义对象</td>
</tr>
<tr>
<td>等比较</td>
<td>√</td>
<td>√</td>
<td>特殊对象</td>
</tr>
</tbody></table>
<h2 id="附：Redux-kindOf-ts-源码"><a href="#附：Redux-kindOf-ts-源码" class="headerlink" title="附：Redux kindOf.ts 源码"></a>附：Redux kindOf.ts 源码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">miniKindOf</span>(<span class="params">val: any</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (val === <span class="keyword">void</span> <span class="number">0</span>) <span class="keyword">return</span> <span class="string">&#x27;undefined&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (val === <span class="literal">null</span>) <span class="keyword">return</span> <span class="string">&#x27;null&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> type = <span class="keyword">typeof</span> val</span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;boolean&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;string&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;number&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;symbol&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;function&#x27;</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> type</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(val)) <span class="keyword">return</span> <span class="string">&#x27;array&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (isDate(val)) <span class="keyword">return</span> <span class="string">&#x27;date&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (isError(val)) <span class="keyword">return</span> <span class="string">&#x27;error&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title">constructorName</span> = <span class="title">ctorName</span>(<span class="params">val</span>)</span><br><span class="line">  <span class="title">switch</span> (<span class="params">constructorName</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Symbol&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Promise&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;WeakMap&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;WeakSet&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Map&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Set&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title">constructorName</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // <span class="title">other</span></span><br><span class="line">  <span class="title">return</span> <span class="title">Object</span>.<span class="title">prototype</span>.<span class="title">toString</span></span><br><span class="line">    .<span class="title">call</span>(<span class="params">val</span>)</span><br><span class="line">    .<span class="title">slice</span>(<span class="params"><span class="number">8</span>, -<span class="number">1</span></span>)</span><br><span class="line">    .<span class="title">toLowerCase</span>(<span class="params"></span>)</span><br><span class="line">    .<span class="title">replace</span>(<span class="params"><span class="regexp">/\s/g</span>, <span class="string">&#x27;&#x27;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">function</span> <span class="title">ctorName</span>(<span class="params">val: any</span>): <span class="title">string</span> | <span class="title">null</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> val.constructor === <span class="string">&#x27;function&#x27;</span> ? val.constructor.name : <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isError</span>(<span class="params">val: any</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    val <span class="keyword">instanceof</span> <span class="built_in">Error</span> ||</span><br><span class="line">    (<span class="keyword">typeof</span> val.message === <span class="string">&#x27;string&#x27;</span> &amp;&amp;</span><br><span class="line">      val.constructor &amp;&amp;</span><br><span class="line">      <span class="keyword">typeof</span> val.constructor.stackTraceLimit === <span class="string">&#x27;number&#x27;</span>)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isDate</span>(<span class="params">val: any</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (val <span class="keyword">instanceof</span> <span class="built_in">Date</span>) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="keyword">typeof</span> val.toDateString === <span class="string">&#x27;function&#x27;</span> &amp;&amp;</span><br><span class="line">    <span class="keyword">typeof</span> val.getDate === <span class="string">&#x27;function&#x27;</span> &amp;&amp;</span><br><span class="line">    <span class="keyword">typeof</span> val.setDate === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">kindOf</span>(<span class="params">val: any</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> typeOfVal: string = <span class="keyword">typeof</span> val</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    typeOfVal = miniKindOf(val)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> typeOfVal</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="3-ES6-中的-NaN"><a href="#3-ES6-中的-NaN" class="headerlink" title="3 ES6 中的 NaN"></a>3 ES6 中的 NaN</h1><h2 id="NaN-和-Number-NaN"><a href="#NaN-和-Number-NaN" class="headerlink" title="NaN 和 Number.NaN"></a>NaN 和 Number.NaN</h2><ul>
<li>  特点 1：typeof 返回的是数字</li>
<li>  特点 2：自己与自己不相等</li>
<li>  特点 3：不能被删除</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(<span class="built_in">window</span>,<span class="string">&quot;NaN&quot;</span>)</span><br><span class="line"><span class="comment">// 结果</span></span><br><span class="line"><span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line"><span class="attr">enumerable</span>: <span class="literal">false</span></span><br><span class="line"><span class="attr">value</span>: <span class="literal">NaN</span></span><br><span class="line"><span class="attr">writable</span>: <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="isNaN"><a href="#isNaN" class="headerlink" title="isNaN()"></a>isNaN()</h2><ul>
<li>  isNaN：检查 toNumber 返回值，如果是 NaN 就返回 true，反之则返回 false</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语义化代码</span></span><br><span class="line"><span class="keyword">const</span> myIsNaN = <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.is(<span class="built_in">Number</span>(val),<span class="literal">NaN</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：并不是一个安全的方法，如果传入 bigInt 或者 Symbol 类型则会抛出错误</p>
<h2 id="ES6-的-Number-isNaN"><a href="#ES6-的-Number-isNaN" class="headerlink" title="ES6 的 Number.isNaN"></a>ES6 的 Number.isNaN</h2><ul>
<li>  Number.isNaN：判断一个值是否是数字，并且值等于 NaN</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语义化代码</span></span><br><span class="line"><span class="built_in">Number</span>.myIsNaN = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> val !==<span class="string">&quot;number&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.is(val,<span class="literal">NaN</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="严格判断-NaN-汇总"><a href="#严格判断-NaN-汇总" class="headerlink" title="严格判断 NaN 汇总"></a>严格判断 NaN 汇总</h2><ul>
<li>  ES6 <code>Number.isNaN()</code></li>
<li>  自身比较（自身不等于自身）</li>
<li>  Object.is</li>
<li>  typeof + NaN</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNaNVal</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.is(val, <span class="literal">NaN</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNaNVal</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val !== val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNaNVal</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;number&#x27;</span> &amp;&amp; <span class="built_in">isNaN</span>(val)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 综合垫片</span></span><br><span class="line"><span class="keyword">if</span> (!(<span class="string">&quot;isNaN&quot;</span> <span class="keyword">in</span> <span class="built_in">Number</span>)) &#123;</span><br><span class="line">    <span class="built_in">Number</span>.isNaN = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;number&#x27;</span> &amp;&amp; <span class="built_in">isNaN</span>(val)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="通过陷阱看本质"><a href="#通过陷阱看本质" class="headerlink" title="通过陷阱看本质"></a>通过陷阱看本质</h2><ol>
<li>例子</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="literal">NaN</span>]</span><br><span class="line">arr.indexOf(<span class="literal">NaN</span>) <span class="comment">// -1</span></span><br><span class="line">arr.includes(<span class="literal">NaN</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>includes：调用内部的<code>Number::sameValueZero</code><br>indexOf：调用内部的<code>Number::equal</code></p>
<hr>
<h1 id="4-数值千分位的-6-种方法"><a href="#4-数值千分位的-6-种方法" class="headerlink" title="4 数值千分位的 6 种方法"></a>4 数值千分位的 6 种方法</h1><p>对一个数值进行千分位，即<code>938765432.02 → 938,765,432.02</code></p>
<h2 id="1-数值转字符串遍历"><a href="#1-数值转字符串遍历" class="headerlink" title="(1) 数值转字符串遍历"></a>(1) 数值转字符串遍历</h2><ul>
<li>  整体思路：数字转字符串，整数部分低位往高位遍历。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">938765432.02</span><br><span class="line">         ^</span><br></pre></td></tr></table></figure>

<ol>
<li>数字转字符串，字符串按照<code>.</code>分割</li>
<li>整数部分拆成字符串数组，并倒序</li>
<li>遍历，按照每 3 位添加<code>,</code>号</li>
<li>拼接整数部分+小数部分</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format_with_array</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 转为字符串，并按照.拆分</span></span><br><span class="line">  <span class="keyword">var</span> arr = (number + <span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">    <span class="comment">// 整数部分再拆分</span></span><br><span class="line">  <span class="keyword">var</span> int = arr[<span class="number">0</span>].split(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="comment">// 小数部分</span></span><br><span class="line">  <span class="keyword">var</span> fraction = arr[<span class="number">1</span>] || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 返回的变量</span></span><br><span class="line">  <span class="keyword">var</span> r = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> len = int.length;</span><br><span class="line">    <span class="comment">// 倒叙并遍历</span></span><br><span class="line">  int.reverse().forEach(<span class="function"><span class="keyword">function</span> (<span class="params">v, i</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 非第一位并且是位值是3的倍数， 添加 &quot;,&quot;</span></span><br><span class="line">      <span class="keyword">if</span> (i !== <span class="number">0</span> &amp;&amp; i % <span class="number">3</span> === <span class="number">0</span>) &#123;</span><br><span class="line">          r = v + <span class="string">&quot;,&quot;</span> + r;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 正常添加字符</span></span><br><span class="line">          r = v + r;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">    <span class="comment">// 整数部分和小数部分拼接</span></span><br><span class="line">  <span class="keyword">return</span> r + (!!fraction ? <span class="string">&quot;.&quot;</span> + fraction : <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> print = <span class="built_in">console</span>.log;</span><br><span class="line">print(format_with_array(<span class="number">938765432.02</span>));</span><br><span class="line"><span class="comment">// 938,765,432.02</span></span><br></pre></td></tr></table></figure>

<h2 id="2-字符串-subString-截取"><a href="#2-字符串-subString-截取" class="headerlink" title="(2) 字符串+subString 截取"></a>(2) 字符串+subString 截取</h2><ul>
<li>  整体思路，数字转字符串，整数部分高位往低位遍历，三位分数</li>
</ul>
<ol>
<li>数字转字符串，字符串按照<code>.</code>分割</li>
<li>整数部分对 3 求模，获取多余部分</li>
<li>按照 3 截取，添加<code>,</code>号</li>
<li>拼接整数部分+小数部分</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format_with_substring</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 数字转字符串, 并按照 .分割</span></span><br><span class="line">  <span class="keyword">var</span> arr = (number + <span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> int = arr[<span class="number">0</span>] + <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> fraction = arr[<span class="number">1</span>] || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 多余的位数</span></span><br><span class="line">  <span class="keyword">var</span> f = int.length % <span class="number">3</span>;</span><br><span class="line">  <span class="comment">// 获取多余的位数，f可能是0， 即r可能是空字符串</span></span><br><span class="line">  <span class="keyword">var</span> r = int.substring(<span class="number">0</span>, f);</span><br><span class="line">  <span class="comment">// 每三位添加&quot;,&quot;和对应的字符</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">Math</span>.floor(int.length / <span class="number">3</span>); i++) &#123;</span><br><span class="line">      r += <span class="string">&#x27;,&#x27;</span> + int.substring(f + i * <span class="number">3</span>, f + (i + <span class="number">1</span>) * <span class="number">3</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//多余的位数，上面</span></span><br><span class="line">  <span class="keyword">if</span> (f === <span class="number">0</span>) &#123;</span><br><span class="line">      r = r.substring(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 整数部分和小数部分拼接</span></span><br><span class="line">  <span class="keyword">return</span> r + (!!fraction ? <span class="string">&quot;.&quot;</span> + fraction : <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> print = <span class="built_in">console</span>.log;</span><br><span class="line">print(format_with_substring(<span class="number">938765432.02</span>));</span><br></pre></td></tr></table></figure>

<h2 id="3-除法-求模"><a href="#3-除法-求模" class="headerlink" title="(3) 除法+求模"></a>(3) 除法+求模</h2><ul>
<li>  整体思路：求模的值添加<code>,</code>，求余值（是否大于 1）计算是否够结束</li>
</ul>
<ol>
<li>值对 1000 求模，获得最高三位</li>
<li>值除以 1000，值是否大于 1 判定是否结束</li>
<li>重复 1 和 2 直到退出</li>
<li>拼接整数部分+小数部分</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format_with_mod</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> n = number;</span><br><span class="line">    <span class="keyword">var</span> r = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> temp;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      	<span class="comment">// 求模的值，用于获取高三位，这里可能有小数</span></span><br><span class="line">        mod = n % <span class="number">1000</span>;</span><br><span class="line">      	<span class="comment">// 值是不是大于1，是继续的条件</span></span><br><span class="line">        n = n / <span class="number">1000</span>;</span><br><span class="line">      	<span class="comment">// 高三位</span></span><br><span class="line">        temp = ~~mod;</span><br><span class="line">      	<span class="comment">// 1. 填充 : n&gt;1 循环未结束， 就要填充为比如，1 =&gt; 001,</span></span><br><span class="line">        <span class="comment">// 不然 1 001， 就会变成 &#x27;11&#x27;,</span></span><br><span class="line">      	<span class="comment">// 2. 拼接 &quot;,&quot;</span></span><br><span class="line">        r =  (n &gt;= <span class="number">1</span> ?<span class="string">`<span class="subst">$&#123;temp&#125;</span>`</span>.padStart(<span class="number">3</span>, <span class="string">&quot;0&quot;</span>): temp) + (!!r ? <span class="string">&quot;,&quot;</span> + r : <span class="string">&quot;&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">while</span> (n &gt;= <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> strNumber = number + <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> index = strNumber.indexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  	<span class="comment">// 拼接小数部分，</span></span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        r += strNumber.substring(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> print = <span class="built_in">console</span>.log;</span><br><span class="line">print(format_with_mod(<span class="number">38765432.02</span>));</span><br></pre></td></tr></table></figure>

<h2 id="4-正则先行断言等"><a href="#4-正则先行断言等" class="headerlink" title="(4) 正则先行断言等"></a>(4) 正则先行断言等</h2><table>
<thead>
<tr>
<th>名字</th>
<th>表达式</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>先行断言（前瞻）</td>
<td><code>exp1(?=exp2)</code></td>
<td>查找 exp2 前面的 exp1</td>
</tr>
<tr>
<td>后行断言（后顾）</td>
<td><code>(?&lt;=exp2)exp1</code></td>
<td>查找 exp2 后面的 exp1</td>
</tr>
<tr>
<td>正向否定查找（负前瞻）</td>
<td><code>exp1(?!exp2)</code></td>
<td>查找后面不是 exp2 的 exp1</td>
</tr>
<tr>
<td>反向否定查找（负后顾）</td>
<td><code>(?&lt;!exp2)exp1</code></td>
<td>查找前面不是 exp2 的 exp1</td>
</tr>
</tbody></table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> print = <span class="built_in">console</span>.log;</span><br><span class="line">print(<span class="regexp">/hello (?=[a-z]+)/</span>.test(<span class="string">&quot;hello a&quot;</span>));  <span class="comment">// true</span></span><br><span class="line">print(<span class="regexp">/hello (?=[a-z]+)/</span>.test(<span class="string">&quot;hello 1&quot;</span>));  <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>数字 3 个一组，查找它前面 1-3 位的数字，<code>.replace(reg, &#39;$&amp;,&#39;)</code>匹配到的内容+”,”号。<br>replace 函数的第二个参数 newvalue 比较特殊，它有一下几个特殊字符串：</p>
<p>$$ 直接量符号(就是当做’$$’字符用)<br>$&amp; 与正则相匹配的字符串<br>$` 匹配字符串左边的字符<br>$\’ 匹配字符串右边的字符<br>$1,$2,$3,…,$n 匹配结果中对应的分组匹配结果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format_with_regex</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> reg = <span class="regexp">/\d&#123;1,3&#125;(?=(\d&#123;3&#125;)+$)/g</span>;</span><br><span class="line">    <span class="keyword">return</span> (number + <span class="string">&#x27;&#x27;</span>).replace(reg, <span class="string">&#x27;$&amp;,&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 987, 654, 321</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> print = <span class="built_in">console</span>.log;</span><br><span class="line">print(format_with_regex(<span class="number">987654321</span>));</span><br></pre></td></tr></table></figure>

<p><code>.replace(reg, callback)</code> 中的 callback<br>|变量名| 代表的值|<br>|—|—|<br>|match| 匹配的子串。（对应于上述的$&amp;。）|<br>|p1,p2, … |假如 replace()方法的第一个参数是一个 RegExp 对象，则代表第 n 个括号匹配的字符串。（对应于上述的$1，$2 等。）例如，如果是用 /(\a+)(\b+)/ 这个来匹配，p1 就是匹配的 \a+，p2 就是匹配的 \b+。|<br>|offset |匹配到的子字符串在原字符串中的偏移量。（比如，如果原字符串是 ‘abcd’，匹配到的子字符串是 ‘bc’，那么这个参数将会是 1）|<br>|string| 被匹配的原字符串。|<br>|NamedCaptureGroup| 命名捕获组匹配的对象|</p>
<p>精确的参数个数依赖于 replace() 的第一个参数是否是一个正则表达式（RegExp）对象，以及这个正则表达式中指定了多少个括号子串，如果这个正则表达式里使用了命名捕获， 还会添加一个命名捕获的对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replacer</span>(<span class="params">match, p1, p2, p3, offset, string</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// p1 is nondigits, p2 digits, and p3 non-alphanumerics</span></span><br><span class="line">  <span class="keyword">return</span> [p1, p2, p3].join(<span class="string">&#x27; - &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> newString = <span class="string">&#x27;abc12345#$*%&#x27;</span>.replace(<span class="regexp">/([^\d]*)(\d*)([^\w]*)/</span>, replacer);</span><br><span class="line"><span class="built_in">console</span>.log(newString);  <span class="comment">// abc - 12345 - #$*%</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format_with_regex</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> reg = <span class="regexp">/\d&#123;1,3&#125;(?=(\d&#123;3&#125;)+$)/g</span>;</span><br><span class="line">    <span class="keyword">return</span> (number + <span class="string">&#x27;&#x27;</span>).replace(reg, <span class="function"><span class="keyword">function</span>(<span class="params">match, ...args</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(match, ...args);</span><br><span class="line">      <span class="keyword">return</span> match + <span class="string">&#x27;,&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">format_with_regex(<span class="number">987654321</span>)</span><br><span class="line"><span class="comment">// 987 321 0 987654321</span></span><br><span class="line"><span class="comment">// 654 321 3 987654321</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format_with_regex</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> reg = <span class="regexp">/(\d)(?=(?:\d&#123;3&#125;)+$)/g</span></span><br><span class="line">    <span class="keyword">return</span> (number + <span class="string">&#x27;&#x27;</span>).replace(reg, <span class="string">&#x27;$1,&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-ECMA-规范"><a href="#5-ECMA-规范" class="headerlink" title="(5) ECMA 规范"></a>(5) ECMA 规范</h2><blockquote>
<p><code>Intl.NumberFormat</code></p>
</blockquote>
<ul>
<li>  语法：<code>new Intl.NumberFormat([locales[,options]])</code></li>
<li>  <code>Intl.NumberFormat</code>是对语言敏感的格式化数字类的构造器类</li>
<li>  基本功能：国际化的数字处理方案，它可以用来显示不同国家对数字的处理偏好。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format_with_Intl</span>(<span class="params">number, minimumFractionDigits, maximumFractionDigits</span>) </span>&#123;</span><br><span class="line">    minimumFractionDigits = minimumFractionDigits || <span class="number">2</span>;</span><br><span class="line">    maximumFractionDigits = (maximumFractionDigits || <span class="number">2</span>);</span><br><span class="line">    maximumFractionDigits = <span class="built_in">Math</span>.max(minimumFractionDigits, maximumFractionDigits);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Intl</span>.NumberFormat(<span class="string">&#x27;en-us&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">maximumFractionDigits</span>: maximumFractionDigits || <span class="number">2</span>,</span><br><span class="line">        <span class="attr">minimumFractionDigits</span>: minimumFractionDigits || <span class="number">2</span></span><br><span class="line">    &#125;).format(number)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用默认配置选项 性能更高</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format_with_Intl</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Intl</span>.NumberFormat(<span class="string">&#x27;en-us&#x27;</span>).format(number)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> print = <span class="built_in">console</span>.log;</span><br><span class="line">print(format_with_Intl(<span class="number">938765432.02</span>));</span><br></pre></td></tr></table></figure>

<h2 id="6-toLocaleString"><a href="#6-toLocaleString" class="headerlink" title="(6) toLocaleString"></a>(6) toLocaleString</h2><ul>
<li>  语法：<code>numObj.toLocaleString([locales[,options]])</code></li>
<li>  功能：其能把数字转为特定语言环境下的表示字符串</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format_with_toLocaleString</span>(<span class="params">number, minimumFractionDigits, maximumFractionDigits</span>) </span>&#123;</span><br><span class="line">    minimumFractionDigits = minimumFractionDigits || <span class="number">2</span>;</span><br><span class="line">    maximumFractionDigits = (maximumFractionDigits || <span class="number">2</span>);</span><br><span class="line">    maximumFractionDigits = <span class="built_in">Math</span>.max(minimumFractionDigits, maximumFractionDigits);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> number.toLocaleString(<span class="string">&quot;en-us&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">maximumFractionDigits</span>: maximumFractionDigits || <span class="number">2</span>,</span><br><span class="line">        <span class="attr">minimumFractionDigits</span>: minimumFractionDigits || <span class="number">2</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 性能更高</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">format_with_toLocaleString</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> number.toLocaleString(<span class="string">&quot;en-us&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> print = <span class="built_in">console</span>.log;</span><br><span class="line">print(format_with_toLocaleString(<span class="number">938765432.02</span>));</span><br></pre></td></tr></table></figure>

<h2 id="性能对比"><a href="#性能对比" class="headerlink" title="性能对比"></a>性能对比</h2><ul>
<li>T0<ul>
<li>  求模添加’,’，求余计算是够结束</li>
</ul>
</li>
<li>T1<ul>
<li>  subString</li>
<li>  正则</li>
<li>  字符串遍历</li>
</ul>
</li>
<li>T2<ul>
<li>  toLocaleString</li>
<li>  Intl.NumberFormat</li>
</ul>
</li>
</ul>
<hr>
<h1 id="5"><a href="#5" class="headerlink" title="5 [] + [], [] + {}, {} + [], {} + {}"></a>5 [] + [], [] + {}, {} + [], {} + {}</h1><h2 id="本质：-二元操作符-规则"><a href="#本质：-二元操作符-规则" class="headerlink" title="本质： 二元操作符+规则"></a>本质： 二元操作符+规则</h2><ul>
<li>  如果操作数是对象，则对象会转换为原始值</li>
<li>  如果其中一个操作数是字符串的话，另一个操作数也会转换为字符串，进行字符串连接</li>
<li>  否则，两个操作数都将转换成数字或 NaN，进行加法操作</li>
</ul>
<h2 id="对象转换为原始数据类型的值"><a href="#对象转换为原始数据类型的值" class="headerlink" title="对象转换为原始数据类型的值"></a>对象转换为原始数据类型的值</h2><ul>
<li>  <code>Symbol.ToPrimitive</code></li>
<li>  <code>Object.prototype.valueOf</code></li>
<li>  <code>Object.prototype.toString</code></li>
</ul>
<h2 id="的原始值"><a href="#的原始值" class="headerlink" title="[]的原始值"></a>[]的原始值</h2><ul>
<li>  <code>typeof [][Symbol.ToPrimitive]</code> undefined （没有这个方法）</li>
<li>  <code>[].valueOf()</code> 返回 [ ]</li>
<li>  <code>[].toString()</code> 返回 ‘’</li>
</ul>
<h2 id="的原始值-1"><a href="#的原始值-1" class="headerlink" title="{}的原始值"></a>{}的原始值</h2><ul>
<li>  <code>typeof &#123;&#125;[Symbol.ToPrimitive]</code> undefined （没有这个方法）</li>
<li>  <code>&#123;&#125;.valueOf() 或 (&#123;&#125;).valueOf()</code> 返回 { }</li>
<li>  <code>(&#123;&#125;).toString()</code> 返回 ‘[object Object]’</li>
</ul>
<h2 id="问题的答案"><a href="#问题的答案" class="headerlink" title="问题的答案"></a>问题的答案</h2><ol>
<li>[] + []<br>等同于<code>[].toString() + [].toString()</code><br>等同于<code>&#39;&#39; + &#39;&#39;</code><br>返回<code>&#39;&#39;</code></li>
<li>[] + {}<br>等同于<code>[].toString() + (&#123;&#125;).toString()</code><br>等同于<code>&#39;&#39; + &#39;[object Object]&#39;</code><br>返回<code>&#39;[object Object]&#39;</code></li>
<li>{} + []<br><strong>在浏览器中</strong><br>等同于<code>&#123;&#125;; + []</code><br>等同于<code> + []</code><br>返回 0</li>
<li>{} + {}<ul>
<li><strong>在 Chrome 中</strong><ul>
<li>Chrome 花括号开头和结尾的语句会自动添加括号包裹</li>
<li>等同于<code>(&#123;&#125;) + (&#123;&#125;)</code></li>
<li><code>&#39;[object Object][object Object]&#39; </code></li>
</ul>
</li>
<li><strong>在其他浏览器中</strong><ul>
<li>等同于<code>&#123;&#125;; + &#123;&#125;</code></li>
<li>等同于<code> + &#39;[object Object]&#39;</code></li>
<li>返回 NaN</li>
</ul>
</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Azem"
      src="/uploads/azem.png">
  <p class="site-author-name" itemprop="name">Azem</p>
  <div class="site-description" itemprop="description">记录些学习笔记，随便写写。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">41</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Azem</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
