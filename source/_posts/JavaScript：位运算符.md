---
title: JavaScript：位运算符
date: 2022-05-21 14:45:56
tags:
    - JavaScript
    - 位运算符
categories:
    - JavaScript进阶
---

# 位运算符的妙用：奇偶数，色值换算，换值， 编码等

## 位运算的基础知识

-   操作数是<font color=red>32 位整数</font>
-   自动转为整数
-   速度 T0 级别，在二进制下进行运算

## 1. 按位与 &

-   两个为 1，则为 1，否则为 0

| a   | b   | a & b |
| --- | --- | ----- |
| 0   | 0   | 0     |
| 0   | 1   | 0     |
| 1   | 0   | 0     |
| 1   | 1   | 1     |

### 判断奇偶数

-   奇数：`num & 1 == 1`
-   偶数：`num & 1 == 0`

> 二进制转换十进制：`b0 * 2 ^ 0 + b1 * 2 ^ 1 + b2 * 2 ^ 2 + b3 * 2 ^ 3 + ....`

## 2. 按位或 |

-   1 个为 1，则为 1

| a   | b   | a & b |
| --- | --- | ----- |
| 0   | 0   | 0     |
| 0   | 1   | 1     |
| 1   | 0   | 1     |
| 1   | 1   | 1     |

### 按位或 | 取整

-   x | 0

进行操作时，系统会将其变为整数进行二进制计算。

```
2.2 | 0

    0 0 1 0
|   0 0 0 0
————————————
    0 0 1 0
```

-   自身 | 自身 = 自身，比较数值相等

```
2 | 2 = 2

    0 0 1 0
|   0 0 1 0
————————————
    0 0 1 0
```

## 3. 按位非 ~

-   按位非运算符（~），反转操作数的位。表象的对数字求负，然后减 1。 `-x-1`

| a   | not a |
| --- | ----- |
| 0   | 1     |
| 1   | 0     |

```
 9 (base 10) = 00000000000000000000000000000000001001 (base 2)
——————————————————————————————
~9 (base 10) = 11111111111111111111111111111111110110 (base 2) = - 10 (base 10)
```

### 按位非 ~ 判断数组中是否包含某个元素

-   不存在， indexOf 返回-1
-   `~ -1 = - ( -1 ) - 1 = 1 - 1 = 0` 为一个假值

```JavaScript
if( ~arr.indexOf(val) ){
    // some code
}
```

补充：类型更严谨的写法
`!!`双感叹号可以将一个值转换为自身对应的布尔值

```JavaScript
!!null = false
!!undefined = false
!!('') = false
!!100 = true
!!'str' = true
```

```JavaScript
if(!!~arr.indexOf(val)){
    // some code
}
```

### 按位非 ~ 取整

-   `~~x`
-   位运算取整
-   `- (-x - 1) - 1`
-   `x + 1 -1 = x`

## 按位异或 ^

-   只有当一个数位为 1 时，返回 1，否则为 0

| a   | b   | a XOR b |
| --- | --- | ------- |
| 0   | 0   | 0       |
| 0   | 1   | 1       |
| 1   | 0   | 1       |
| 1   | 1   | 0       |

### 异或的特殊定律

-   归零律： `a ^ a = 0` 自己异或自己，位数上的值肯定相同
-   <font color=red>恒等律</font>： `a ^ 0 = a` 自己异或 0，恒等于自己
-   自反： `a ^ a ^ a = 0 ^ a = a`
-   结合律： `a ^ b ^ c == c ^ b ^ a`

### 按位异或 ^ 值交换

-   变量为数字，完成值的交换（不用增加临时变量）

```JavaScript
let a = 10
let b = 20

a ^= b
b ^= a // b = b ^ (a ^ b) = a ^ 0
a ^= b // a = (a ^ b) ^ a = b ^ 0
```

## 位移运算

### RGB 转 16 进制

-   基础知识

```
RGB   255    255    255
       ↓      ↓      ↓
 #    FF     FF     FF
```

```JavaScript
function colorRGBToHex(RGB) {
    // split 的参数可以是正则
    // "rgb(204,0,255)
    const rgbArr = rgb.split(/[^\d]+/)
    // ['', '204', '0', '255', '0']
    const color = rgbArr[1] << 16 | rgbArr[2] << 8 | rgbArr[3]
    return "#" + color.toString(16)
}
```

![4-3-1](4-3-1.png)
![4-3-2](4-3-2.png)

### 16 进制转 RGB

```JavaScript
// "#CC00FF"
function colorHexToRGB(hex){
    // 转为6位的16进制 0xCC00FF
    let newHex = hex.replace("#","0x")
    let r = newHex >> 16
    let g = newHex >> 8 & 0xff
    let b = newHex & 0xff
    return `rgb(${r},${g},${b})`
}
```

1. 先取前八位（R），向右移 16 位，即可以到 11001100。十进制：R(204)

![4-3-3](4-3-3.png)

2. 取中间（G），右移 8 位，然后 `& 0xff(255)`
   ![4-3-3](4-3-4.png)

3. 去最后高位（B），直接 `& 0xff(255)`

![4-3-3](4-3-5.png)

### 位移运算应用场景

-   base64 编码
-   简单加密解密

## 总结

| 符号   | 名称     | 特点                                               | 应用场景                             |
| ------ | -------- | -------------------------------------------------- | ------------------------------------ |
| &      | 按位与   | 两个操作数都为 1，则为 1                           | 1.判断奇偶数                         |
| &#124; | 按位或   | 两个操作数至少一个 1 为 1，则为 1                  | 1.奇偶数 <br> 2.等于某个整数值       |
| ~      | 按位非   | 取反减 1， -x-1                                    | 1.取整 <br>2.数组中是否存在某个值    |
| ^      | 按位异或 | 有且只有一个操作数为 1，则为 1                     | 1.整数比较 <br>2.数字交互            |
| >>, << | 位移     | 移动指定位数，超出的位数将会被清除，缺省位则会补零 | 1.转为整数 <br>2.色值转换 <br>3.编码 |
